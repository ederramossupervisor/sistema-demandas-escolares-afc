<!DOCTYPE html>
<html lang="pt-br">
<head>
    <%- include('partials/head') %>
    
    <style>
        .user-card {
            transition: all 0.3s;
            border-left: 4px solid #007bff;
        }
        
        .user-card.inactive {
            border-left-color: #dc3545;
            opacity: 0.7;
        }
        
        .user-card.supervisor {
            border-left-color: #28a745;
        }
        
        .user-card.administrador {
            border-left-color: #6f42c1;
        }
        
        .status-badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
        }
        
        .avatar {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .filters-card {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
        }
        
        .table-hover tbody tr:hover {
            background-color: rgba(0, 123, 255, 0.05);
        }
    </style>
</head>
<body>
    <!-- INCLUI a navbar -->
    <%- include('partials/navbar') %>

    <div class="container-fluid mt-4">
        <div class="row">
            <!-- Sidebar Unificada - Vis√≠vel apenas no desktop -->
            <div class="col-md-3 d-none d-md-block">
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-body p-3">
                        <%- include('partials/sidebar', { 
                            currentPage: 'usuarios', 
                            user: user,
                            escolas: escolas || []
                        }); %>
                    </div>
                </div>
            </div>

            <!-- Conte√∫do Principal -->
            <div class="col-md-9">
                <!-- VERIFICA√á√ÉO DE PERMISS√ÉO -->
                <% if (!user || (user.tipo !== 'administrador' && user.tipo !== 'supervisor')) { %>
                    <div class="row">
                        <div class="col-12">
                            <div class="alert alert-danger mt-5" style="max-width: 800px; margin: 0 auto;">
                                <div class="text-center">
                                    <i class="fas fa-ban fa-3x text-danger mb-3"></i>
                                    <h3 class="alert-heading">Acesso Restrito</h3>
                                    <p class="lead">Voc√™ n√£o tem permiss√£o para acessar esta funcionalidade.</p>
                                    <hr>
                                    <p class="mb-3">
                                        <strong>Apenas Administradores e Supervisores</strong> podem gerenciar usu√°rios.
                                    </p>
                                    <div class="mt-4">
                                        <a href="/dashboard" class="btn btn-primary btn-lg">
                                            <i class="fas fa-home me-2"></i> Voltar ao Dashboard
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                <% } else { %>
                
                <!-- Cabe√ßalho da P√°gina -->
                <div class="row mb-4">
                    <div class="col-8">
                        <h1 class="text-gradient">
                            <i class="fas fa-users me-2"></i> Gest√£o de Usu√°rios
                        </h1>
                        <p class="text-muted lead">
                            <i class="fas fa-info-circle me-1"></i>
                            Gerencie todos os usu√°rios do sistema
                        </p>
                    </div>
                    <div class="col-4 text-end">
                        <a href="/cadastro" class="btn btn-success btn-lg">
                            <i class="fas fa-user-plus me-2"></i> Novo Usu√°rio
                        </a>
                    </div>
                </div>

                <!-- Card de Filtros -->
                <div class="card filters-card mb-4">
                    <div class="card-body">
                        <h5 class="card-title mb-3">
                            <i class="fas fa-filter me-2"></i> Filtros
                        </h5>
                        <div class="row g-3">
                            <div class="col-md-3">
                                <label class="form-label">Tipo de Usu√°rio</label>
                                <select class="form-select" id="filterTipo">
                                    <option value="">Todos os tipos</option>
                                    <option value="Administrador(a)">Administrador(a)</option>
                                    <option value="Supervisor(a)">Supervisor(a)</option>
                                    <option value="Diretor(a)">Diretor(a)</option>
                                    <option value="Usu√°rio(a)">Usu√°rio(a)</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Status</label>
                                <select class="form-select" id="filterStatus">
                                    <option value="">Todos</option>
                                    <option value="ativo">Ativos</option>
                                    <option value="inativo">Inativos</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Departamento</label>
                                <select class="form-select" id="filterDepartamento">
                                    <option value="">Todos</option>
                                    <% if (departamentos) { %>
                                        <% departamentos.forEach(function(dept) { %>
                                            <option value="<%= dept.valor %>"><%= dept.label %></option>
                                        <% }); %>
                                    <% } else { %>
                                        <option value="Supervis√£o">Supervis√£o</option>
                                        <option value="Gest√£o">Gest√£o</option>
                                        <option value="Pedag√≥gico">Pedag√≥gico</option>
                                        <option value="Secretaria">Secretaria</option>
                                    <% } %>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Escola</label>
                                <select class="form-select" id="filterEscola">
                                    <option value="">Todas as escolas</option>
                                    <% escolas.forEach(function(escola) { %>
                                        <option value="<%= escola %>"><%= escola %></option>
                                    <% }); %>
                                </select>
                            </div>
                            <div class="col-12 text-end">
                                <button class="btn btn-outline-secondary" onclick="limparFiltros()">
                                    <i class="fas fa-times me-1"></i> Limpar Filtros
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tabela de Usu√°rios -->
                <div class="card border-0 shadow-lg">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0 text-white">
                            <i class="fas fa-list me-2"></i> Usu√°rios Cadastrados
                        </h5>
                        <span class="badge bg-light text-dark fs-6">
                            Total: <span id="totalUsuarios">0</span> usu√°rio(s)
                        </span>
                    </div>
                    
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0" id="tabelaUsuarios">
                                <thead class="table-light">
                                    <tr>
                                        <th style="width: 50px;"></th>
                                        <th>Usu√°rio</th>
                                        <th>Tipo</th>
                                        <th>Departamento</th>
                                        <th>Escola</th>
                                        <th>Email</th>
                                        <th>Status</th>
                                        <th style="width: 120px;">A√ß√µes</th>
                                    </tr>
                                </thead>
                                <tbody id="tbodyUsuarios">
                                    <!-- Os usu√°rios ser√£o carregados aqui via JavaScript -->
                                    <tr id="loadingRow">
                                        <td colspan="8" class="text-center py-5">
                                            <div class="spinner-border text-primary" role="status">
                                                <span class="visually-hidden">Carregando...</span>
                                            </div>
                                            <p class="mt-2 text-muted">Carregando usu√°rios...</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="card-footer text-muted">
                        <div class="row">
                            <div class="col-md-6">
                                <small>
                                    <i class="fas fa-info-circle me-1"></i>
                                    Clique no nome do usu√°rio para ver detalhes
                                </small>
                            </div>
                            <div class="col-md-6 text-end">
                                <small id="atualizadoEm"></small>
                            </div>
                        </div>
                    </div>
                </div>
                
                <% } %> <!-- Fecha o else da verifica√ß√£o de permiss√£o -->
            </div>
        </div>
    </div>

    <!-- INCLUI o rodap√© -->
    <%- include('partials/footer', {
        user: user,
        totalDemandas: totalDemandas
    }) %>

    <!-- INCLUI o bot√£o PWA -->
    <%- include('partials/pwa-button') %>

    <!-- INCLUI os scripts -->
    <%- include('partials/scripts') %>

    <!-- Scripts espec√≠ficos da p√°gina de usu√°rios -->
    <script>
    // Dados mockados (substituir por API real depois)
    const usuariosMock = [
        {
            id: 1,
            nome: "Administrador do Sistema",
            email: "admin@escola.gov.br",
            username: "admin",
            tipo: "Administrador(a)",
            departamento: "Supervis√£o",
            lotacao: "Todas as Escolas",
            escolasVinculadas: ["EMEF Teste 1", "EMEF Teste 2"],
            ativo: true,
            dataCadastro: "2024-01-01",
            cargo: "Administrador do Sistema",
            telefone: "(27) 99999-9999"
        },
        {
            id: 2,
            nome: "Supervisor Regional",
            email: "supervisor@escola.gov.br",
            username: "supervisor",
            tipo: "Supervisor(a)",
            departamento: "Supervis√£o",
            lotacao: "EMEF Teste 1",
            escolasVinculadas: ["EMEF Teste 1", "EMEF Teste 2"],
            ativo: true,
            dataCadastro: "2024-01-02",
            cargo: "Supervisor Regional",
            telefone: "(27) 99999-9998"
        },
        {
            id: 3,
            nome: "Diretor Escolar",
            email: "diretor@escola.gov.br",
            username: "diretor",
            tipo: "Diretor(a)",
            departamento: "Gest√£o",
            lotacao: "EMEF Teste 1",
            escolasVinculadas: ["EMEF Teste 1"],
            ativo: true,
            dataCadastro: "2024-01-03",
            cargo: "Diretor",
            telefone: "(27) 99999-9997"
        },
        {
            id: 4,
            nome: "Professora Maria Silva",
            email: "maria.silva@escola.gov.br",
            username: "maria.silva",
            tipo: "Usu√°rio(a)",
            departamento: "Pedag√≥gico",
            lotacao: "EMEF Teste 2",
            escolasVinculadas: ["EMEF Teste 2"],
            ativo: true,
            dataCadastro: "2024-01-04",
            cargo: "Professora",
            telefone: "(27) 99999-9996"
        },
        {
            id: 5,
            nome: "Secret√°rio Jo√£o Santos",
            email: "joao.santos@escola.gov.br",
            username: "joao.santos",
            tipo: "Usu√°rio(a)",
            departamento: "Secretaria",
            lotacao: "EMEF Teste 1",
            escolasVinculadas: ["EMEF Teste 1"],
            ativo: false,
            dataCadastro: "2024-01-05",
            cargo: "Secret√°rio",
            telefone: "(27) 99999-9995"
        }
    ];
    
    // Fun√ß√£o para carregar usu√°rios
    function carregarUsuarios() {
        const tbody = document.getElementById('tbodyUsuarios');
        const filtroTipo = document.getElementById('filterTipo').value;
        const filtroStatus = document.getElementById('filterStatus').value;
        const filtroDepartamento = document.getElementById('filterDepartamento').value;
        const filtroEscola = document.getElementById('filterEscola').value;
        
        // Filtrar usu√°rios
        let usuariosFiltrados = usuariosMock.filter(usuario => {
            // Filtrar por tipo
            if (filtroTipo && usuario.tipo !== filtroTipo) return false;
            
            // Filtrar por status
            if (filtroStatus === 'ativo' && !usuario.ativo) return false;
            if (filtroStatus === 'inativo' && usuario.ativo) return false;
            
            // Filtrar por departamento
            if (filtroDepartamento && usuario.departamento !== filtroDepartamento) return false;
            
            // Filtrar por escola
            if (filtroEscola && !usuario.escolasVinculadas.includes(filtroEscola)) return false;
            
            return true;
        });
        
        // Limpar tabela
        tbody.innerHTML = '';
        
        if (usuariosFiltrados.length === 0) {
            tbody.innerHTML = `
                <tr>
                    <td colspan="8" class="text-center py-5">
                        <i class="fas fa-users-slash fa-3x text-muted mb-3"></i>
                        <p class="h5 text-muted">Nenhum usu√°rio encontrado</p>
                        <p class="text-muted">Tente alterar os filtros de busca</p>
                    </td>
                </tr>
            `;
        } else {
            // Adicionar usu√°rios √† tabela
            usuariosFiltrados.forEach(usuario => {
                const inicial = usuario.nome.charAt(0).toUpperCase();
                const dataFormatada = new Date(usuario.dataCadastro).toLocaleDateString('pt-BR');
                
                let statusBadge = usuario.ativo 
                    ? '<span class="badge bg-success status-badge">Ativo</span>'
                    : '<span class="badge bg-danger status-badge">Inativo</span>';
                
                let tipoBadge = '';
                switch(usuario.tipo) {
                    case 'Administrador(a)':
                        tipoBadge = '<span class="badge bg-purple">Admin</span>';
                        break;
                    case 'Supervisor(a)':
                        tipoBadge = '<span class="badge bg-success">Supervisor</span>';
                        break;
                    case 'Diretor(a)':
                        tipoBadge = '<span class="badge bg-primary">Diretor</span>';
                        break;
                    default:
                        tipoBadge = '<span class="badge bg-secondary">Usu√°rio</span>';
                }
                
                const row = document.createElement('tr');
                row.className = usuario.ativo ? '' : 'table-secondary';
                row.innerHTML = `
                    <td class="text-center">
                        <div class="avatar rounded-circle d-flex align-items-center justify-content-center mx-auto">
                            ${inicial}
                        </div>
                    </td>
                    <td>
                        <strong class="d-block">${usuario.nome}</strong>
                        <small class="text-muted">@${usuario.username}</small>
                    </td>
                    <td>
                        ${tipoBadge}<br>
                        <small>${usuario.cargo}</small>
                    </td>
                    <td>${usuario.departamento}</td>
                    <td>${usuario.lotacao}</td>
                    <td>
                        <small>${usuario.email}</small><br>
                        <small class="text-muted">${usuario.telefone || 'Sem telefone'}</small>
                    </td>
                    <td>
                        ${statusBadge}<br>
                        <small class="text-muted">Cadastrado em ${dataFormatada}</small>
                    </td>
                    <td>
                        <div class="btn-group btn-group-sm" role="group">
                            <button type="button" class="btn btn-outline-primary" 
                                    onclick="verDetalhesUsuarioComNotificacao(${usuario.id})"
                                    title="Ver detalhes">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button type="button" class="btn btn-outline-warning" 
                                    onclick="editarUsuarioComNotificacao(${usuario.id})"
                                    title="Editar">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button type="button" class="btn ${usuario.ativo ? 'btn-outline-danger' : 'btn-outline-success'}" 
                                    onclick="toggleStatusUsuarioComNotificacao(${usuario.id})"
                                    title="${usuario.ativo ? 'Desativar' : 'Ativar'}">
                                <i class="fas ${usuario.ativo ? 'fa-user-slash' : 'fa-user-check'}"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Atualizar contador
        document.getElementById('totalUsuarios').textContent = usuariosFiltrados.length;
        
        // Atualizar data/hora
        const agora = new Date();
        document.getElementById('atualizadoEm').textContent = 
            `Atualizado em ${agora.toLocaleDateString('pt-BR')} √†s ${agora.toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'})}`;
    }
    
        
    // Configurar eventos dos filtros
    document.getElementById('filterTipo').addEventListener('change', carregarUsuarios);
    document.getElementById('filterStatus').addEventListener('change', carregarUsuarios);
    document.getElementById('filterDepartamento').addEventListener('change', carregarUsuarios);
    document.getElementById('filterEscola').addEventListener('change', carregarUsuarios);
    
    // Carregar usu√°rios quando a p√°gina carregar
    document.addEventListener('DOMContentLoaded', function() {
        // Pequeno delay para simular carregamento
        setTimeout(carregarUsuarios, 500);
    });
    
    console.log('‚úÖ P√°gina de usu√°rios carregada com sucesso!');
    
    /* ============================================
   üîî SISTEMA DE NOTIFICA√á√ïES - P√ÅGINA DE USU√ÅRIOS
   ============================================ */

// 1Ô∏è‚É£ NOTIFICA√á√ÉO AO CARREGAR A P√ÅGINA
document.addEventListener('DOMContentLoaded', function() {
    console.log('üë• P√°gina de usu√°rios carregada - Configurando notifica√ß√µes...');
    
    // Pequeno delay para garantir que tudo carregou
    setTimeout(() => {
        if (typeof showInfo === 'function') {
            showInfo(
                'üë• Gest√£o de Usu√°rios',
                'Carregando todos os usu√°rios do sistema...',
                2000
            );
        }
        
        // Ap√≥s carregar os usu√°rios
        setTimeout(() => {
            const totalUsuarios = parseInt(document.getElementById('totalUsuarios').textContent);
            
            if (totalUsuarios > 0 && typeof showSuccess === 'function') {
                showSuccess(
                    '‚úÖ Usu√°rios Carregados',
                    `${totalUsuarios} usu√°rio(s) encontrado(s) no sistema.`,
                    3000
                );
            } else if (totalUsuarios === 0 && typeof showWarning === 'function') {
                showWarning(
                    'üì≠ Nenhum Usu√°rio',
                    'Nenhum usu√°rio encontrado. Use o bot√£o "Novo Usu√°rio" para come√ßar.',
                    4000
                );
            }
        }, 1500);
    }, 500);
});

// 2Ô∏è‚É£ NOTIFICA√á√ÉO AO ALTERAR STATUS DO USU√ÅRIO (Ativar/Desativar)
function toggleStatusUsuarioComNotificacao(id) {
    const usuario = usuariosMock.find(u => u.id === id);
    if (!usuario) {
        if (typeof showError === 'function') {
            showError('‚ùå Erro', 'Usu√°rio n√£o encontrado.', 3000);
        }
        return;
    }
    
    const acao = usuario.ativo ? 'desativar' : 'ativar';
    const nomeUsuario = usuario.nome.split(' ')[0]; // Primeiro nome
    
    if (typeof Swal !== 'undefined') {
        Swal.fire({
            title: `‚ö†Ô∏è ${acao.charAt(0).toUpperCase() + acao.slice(1)} Usu√°rio?`,
            html: `
                <div class="text-center">
                    <div class="avatar rounded-circle d-flex align-items-center justify-content-center mx-auto mb-3" 
                         style="width: 60px; height: 60px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; font-size: 1.5rem; font-weight: bold;">
                        ${usuario.nome.charAt(0).toUpperCase()}
                    </div>
                    <p class="mb-2"><strong>${usuario.nome}</strong></p>
                    <p class="text-muted mb-3">
                        <i class="fas fa-envelope me-1"></i> ${usuario.email}<br>
                        <i class="fas fa-user-tag me-1"></i> ${usuario.tipo}
                    </p>
                    <div class="alert alert-${usuario.ativo ? 'warning' : 'info'}">
                        <i class="fas fa-${usuario.ativo ? 'user-slash' : 'user-check'} me-2"></i>
                        <strong>Esta a√ß√£o ir√° ${acao} o acesso do usu√°rio ao sistema.</strong>
                        ${usuario.ativo 
                            ? 'O usu√°rio n√£o poder√° fazer login at√© ser reativado.' 
                            : 'O usu√°rio poder√° fazer login novamente.'}
                    </div>
                </div>
            `,
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: usuario.ativo ? '#d33' : '#28a745',
            cancelButtonColor: '#6c757d',
            confirmButtonText: `<i class="fas fa-${usuario.ativo ? 'user-slash' : 'user-check'} me-1"></i> Sim, ${acao}!`,
            cancelButtonText: '<i class="fas fa-times me-1"></i> Cancelar'
        }).then(async (result) => {
            if (result.isConfirmed) {
                try {
                    // Mostrar loading
                    Swal.fire({
                        title: `${usuario.ativo ? 'Desativando...' : 'Ativando...'}`,
                        text: `${usuario.ativo ? 'Removendo acesso do usu√°rio' : 'Restaurando acesso do usu√°rio'}`,
                        allowOutsideClick: false,
                        showConfirmButton: false,
                        didOpen: () => {
                            Swal.showLoading();
                        }
                    });
                    
                    // SIMULA√á√ÉO: Aguardar 1.5 segundos (como se fosse API real)
                    await new Promise(resolve => setTimeout(resolve, 1500));
                    
                    // Atualizar status localmente (simula√ß√£o)
                    usuario.ativo = !usuario.ativo;
                    
                    // Fechar SweetAlert
                    Swal.close();
                    
                    // Recarregar lista
                    carregarUsuarios();
                    
                    // MOSTRAR NOTIFICA√á√ÉO PERSONALIZADA
                    if (typeof showSuccess === 'function') {
                        showSuccess(
                            usuario.ativo ? '‚úÖ Usu√°rio Ativado!' : '‚úÖ Usu√°rio Desativado!',
                            `<strong>${usuario.nome}</strong> foi ${usuario.ativo ? 'ativado' : 'desativado'} com sucesso.<br>
                             ${usuario.ativo 
                                 ? 'O usu√°rio agora pode fazer login no sistema.' 
                                 : 'O usu√°rio n√£o poder√° acessar o sistema at√© ser reativado.'}`,
                            5000
                        );
                    }
                    
                } catch (error) {
                    console.error('‚ùå Erro ao alterar status:', error);
                    
                    // Fechar loading
                    Swal.close();
                    
                    // MOSTRAR NOTIFICA√á√ÉO DE ERRO
                    if (typeof showError === 'function') {
                        showError(
                            '‚ùå Erro ao Alterar Status',
                            `N√£o foi poss√≠vel ${acao} o usu√°rio: ${error.message}`,
                            5000
                        );
                    }
                }
            }
        });
    } else {
        // Fallback sem SweetAlert
        if (confirm(`Tem certeza que deseja ${acao} o usu√°rio ${usuario.nome}?`)) {
            // SIMULA√á√ÉO: Alterar status
            usuario.ativo = !usuario.ativo;
            carregarUsuarios();
            
            // MOSTRAR NOTIFICA√á√ÉO
            if (typeof showSuccess === 'function') {
                showSuccess(
                    usuario.ativo ? '‚úÖ Usu√°rio Ativado!' : '‚úÖ Usu√°rio Desativado!',
                    `O usu√°rio ${usuario.nome} foi ${usuario.ativo ? 'ativado' : 'desativado'} com sucesso.`,
                    4000
                );
            } else {
                alert(`Usu√°rio ${usuario.ativo ? 'ativado' : 'desativado'} com sucesso!`);
            }
        }
    }
}

// 3Ô∏è‚É£ NOTIFICA√á√ÉO AO VER DETALHES DO USU√ÅRIO
function verDetalhesUsuarioComNotificacao(id) {
    const usuario = usuariosMock.find(u => u.id === id);
    if (!usuario) {
        if (typeof showError === 'function') {
            showError('‚ùå Erro', 'Usu√°rio n√£o encontrado.', 3000);
        }
        return;
    }
    
    // MOSTRAR NOTIFICA√á√ÉO INFORMATIVA
    if (typeof showInfo === 'function') {
        showInfo(
            'üë§ Detalhes do Usu√°rio',
            `Carregando informa√ß√µes de <strong>${usuario.nome}</strong>...`,
            2000
        );
    }
    
    // Aqui viria a l√≥gica real para mostrar os detalhes
    // Por enquanto, simulamos com um alerta
    setTimeout(() => {
        if (typeof Swal !== 'undefined') {
            Swal.fire({
                title: `üë§ ${usuario.nome}`,
                html: `
                    <div class="text-start">
                        <div class="d-flex align-items-center mb-3">
                            <div class="avatar rounded-circle d-flex align-items-center justify-content-center me-3" 
                                 style="width: 60px; height: 60px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; font-size: 1.5rem; font-weight: bold;">
                                ${usuario.nome.charAt(0).toUpperCase()}
                            </div>
                            <div>
                                <h5 class="mb-1">${usuario.nome}</h5>
                                <span class="badge bg-${usuario.ativo ? 'success' : 'danger'}">
                                    ${usuario.ativo ? 'Ativo' : 'Inativo'}
                                </span>
                                <span class="badge bg-secondary ms-1">${usuario.tipo}</span>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong><i class="fas fa-envelope me-2"></i> Email:</strong><br>
                                ${usuario.email}</p>
                                
                                <p><strong><i class="fas fa-user-tag me-2"></i> Cargo:</strong><br>
                                ${usuario.cargo || 'N√£o informado'}</p>
                                
                                <p><strong><i class="fas fa-building me-2"></i> Departamento:</strong><br>
                                ${usuario.departamento}</p>
                            </div>
                            <div class="col-md-6">
                                <p><strong><i class="fas fa-school me-2"></i> Lota√ß√£o:</strong><br>
                                ${usuario.lotacao}</p>
                                
                                <p><strong><i class="fas fa-phone me-2"></i> Telefone:</strong><br>
                                ${usuario.telefone || 'N√£o informado'}</p>
                                
                                <p><strong><i class="fas fa-calendar me-2"></i> Data de Cadastro:</strong><br>
                                ${new Date(usuario.dataCadastro).toLocaleDateString('pt-BR')}</p>
                            </div>
                        </div>
                        
                        <div class="mt-3">
                            <strong><i class="fas fa-school me-2"></i> Escolas Vinculadas:</strong><br>
                            <div class="mt-1">
                                ${usuario.escolasVinculadas.map(escola => 
                                    `<span class="badge bg-light text-dark me-1 mb-1">${escola}</span>`
                                ).join('')}
                            </div>
                        </div>
                    </div>
                `,
                icon: 'info',
                confirmButtonText: 'Fechar',
                confirmButtonColor: '#3085d6',
                width: '600px'
            });
        } else {
            alert(`Detalhes de ${usuario.nome}\n\nEmail: ${usuario.email}\nTipo: ${usuario.tipo}\nStatus: ${usuario.ativo ? 'Ativo' : 'Inativo'}`);
        }
    }, 500);
}

// 4Ô∏è‚É£ NOTIFICA√á√ÉO AO EDITAR USU√ÅRIO
function editarUsuarioComNotificacao(id) {
    const usuario = usuariosMock.find(u => u.id === id);
    if (!usuario) {
        if (typeof showError === 'function') {
            showError('‚ùå Erro', 'Usu√°rio n√£o encontrado.', 3000);
        }
        return;
    }
    
    // MOSTRAR NOTIFICA√á√ÉO
    if (typeof showInfo === 'function') {
        showInfo(
            '‚úèÔ∏è Editando Usu√°rio',
            `Abrindo formul√°rio para edi√ß√£o de <strong>${usuario.nome}</strong>...`,
            2000
        );
    }
    
    // Simula√ß√£o: Redirecionar para p√°gina de edi√ß√£o
    setTimeout(() => {
        // Aqui normalmente seria window.location.href = `/editar-usuario/${id}`;
        if (typeof showWarning === 'function') {
            showWarning(
                'üöß Funcionalidade em Desenvolvimento',
                'A p√°gina de edi√ß√£o de usu√°rios est√° em desenvolvimento.<br>Por enquanto, use o cadastro de novo usu√°rio.',
                4000
            );
        }
    }, 1000);
}

// 5Ô∏è‚É£ NOTIFICA√á√ÉO AO APLICAR FILTROS
function configurarNotificacoesFiltros() {
    const filtros = ['filterTipo', 'filterStatus', 'filterDepartamento', 'filterEscola'];
    
    filtros.forEach(id => {
        const elemento = document.getElementById(id);
        if (elemento) {
            elemento.addEventListener('change', function() {
                const filtroNome = this.options[this.selectedIndex].text;
                if (filtroNome && filtroNome !== 'Todos' && filtroNome !== 'Todos os tipos' && 
                    filtroNome !== 'Todas as escolas' && typeof showInfo === 'function') {
                    
                    setTimeout(() => {
                        const label = this.previousElementSibling?.textContent || 'Filtro';
                        showInfo(
                            'üîç Filtrando Usu√°rios',
                            `Aplicando filtro: <strong>${label}</strong> = ${filtroNome}`,
                            2000
                        );
                    }, 300);
                }
            });
        }
    });
}

// 6Ô∏è‚É£ NOTIFICA√á√ÉO AO LIMPAR FILTROS
function limparFiltrosComNotificacao() {
    if (typeof showInfo === 'function') {
        showInfo(
            'üîÑ Limpando Filtros',
            'Removendo todos os filtros aplicados...',
            2000
        );
    }
    
    // Executar limpeza ap√≥s notifica√ß√£o
    setTimeout(() => {
        limparFiltros();
        
        if (typeof showSuccess === 'function') {
            showSuccess(
                '‚úÖ Filtros Removidos',
                'Todos os filtros foram limpos. Mostrando todos os usu√°rios.',
                3000
            );
        }
    }, 500);
}

// 7Ô∏è‚É£ NOTIFICA√á√ÉO AO CLICAR EM "NOVO USU√ÅRIO"
function configurarNotificacaoNovoUsuario() {
    const btnNovoUsuario = document.querySelector('a[href="/cadastro"]');
    if (btnNovoUsuario) {
        btnNovoUsuario.addEventListener('click', function(e) {
            setTimeout(() => {
                if (typeof showInfo === 'function') {
                    showInfo(
                        'üë§ Novo Usu√°rio',
                        'Redirecionando para o formul√°rio de cadastro...',
                        2000
                    );
                }
            }, 100);
        });
    }
}

// 8Ô∏è‚É£ SUBSTITUIR FUN√á√ïES ORIGINAIS
// Remova ou comente as fun√ß√µes originais e use estas novas

// Encontre estas fun√ß√µes no seu c√≥digo original e SUBSTITUA:
// 1. function verDetalhesUsuario(id) ‚Üí Substituir por verDetalhesUsuarioComNotificacao(id)
// 2. function editarUsuario(id) ‚Üí Substituir por editarUsuarioComNotificacao(id)
// 3. function toggleStatusUsuario(id) ‚Üí Substituir por toggleStatusUsuarioComNotificacao(id)
// 4. function limparFiltros() ‚Üí Chamar limparFiltrosComNotificacao() no bot√£o

// 9Ô∏è‚É£ CONFIGURAR TODOS OS EVENTOS
function configurarTodasNotificacoesUsuarios() {
    console.log('üîî Configurando notifica√ß√µes da p√°gina de usu√°rios...');
    
    configurarNotificacoesFiltros();
    configurarNotificacaoNovoUsuario();
    
    // Atualizar bot√£o "Limpar Filtros"
    const btnLimpar = document.querySelector('button[onclick="limparFiltros()"]');
    if (btnLimpar) {
        btnLimpar.setAttribute('onclick', 'limparFiltrosComNotificacao()');
    }
    
    console.log('‚úÖ Notifica√ß√µes da p√°gina de usu√°rios configuradas!');
}

// üîü INICIALIZAR
setTimeout(() => {
    configurarTodasNotificacoesUsuarios();
}, 1000);

// Fun√ß√£o para testar notifica√ß√µes (apenas desenvolvimento)
window.testarNotificacoesUsuarios = function() {
    if (typeof showSuccess === 'function') {
        showSuccess('‚úÖ Teste Usu√°rios', 'Sistema de notifica√ß√µes funcionando na p√°gina de usu√°rios!', 3000);
    }
};
</script>
</body>
</html>