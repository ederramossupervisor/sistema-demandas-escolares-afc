<!DOCTYPE html>
<html lang="pt-br">
<head>
    <!-- INCLUI o cabeÃ§alho completo -->
    <%- include('partials/head') %>
</head>
<body>
    <!-- INCLUI a navbar -->
    <%- include('partials/navbar') %>

    <div class="container-fluid mt-4">
        <div class="row">
            <!-- INCLUI a sidebar -->
            <%- include('partials/sidebar', {
                currentPage: 'demandas',
                escolas: escolas,
                user: user
            }) %>

            <!-- ConteÃºdo Principal -->
            <div class="col-md-9">
                <!-- CabeÃ§alho da PÃ¡gina -->
                <div class="row mb-4">
                    <div class="col-12">
                        <h1 class="text-gradient">
                            <i class="fas fa-tasks me-2"></i> Gerenciar Demandas
                        </h1>
                        <p class="text-muted lead">
                            <i class="fas fa-info-circle me-1"></i>
                            Crie, visualize e gerencie todas as demandas escolares
                        </p>
                    </div>
                </div>

                <!-- ConteÃºdo da PÃ¡gina -->
                <div class="card border-0 shadow-lg">
                    <div class="card-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h5 class="mb-0 text-white"><i class="fas fa-filter me-2"></i> Filtros AvanÃ§ados</h5>
                                <small class="text-white opacity-75">Filtre as demandas por status, escola ou prioridade</small>
                            </div>
                            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#novaDemandaModal">
                                <i class="fas fa-plus-circle me-2"></i> Nova Demanda
                            </button>
                        </div>
                    </div>
                    
                    <div class="card-body">
                        <!-- Filtros -->
                        <div class="row g-3 mb-4">
                            <div class="col-md-3">
                                <label class="form-label fw-bold"><i class="fas fa-flag me-1"></i> Status</label>
                                <select class="form-select">
                                    <option value="">Todas as Demandas</option>
                                    <option value="pendente">â³ Pendentes</option>
                                    <option value="em_andamento">ğŸ”„ Em Andamento</option>
                                    <option value="concluida">âœ… ConcluÃ­das</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label fw-bold"><i class="fas fa-school me-1"></i> Escola</label>
                                <select class="form-select">
                                    <option value="">Todas as Escolas</option>
                                    <% escolas.forEach(function(escola) { %>
                                        <option value="<%= escola %>"><%= escola.substring(0, 30) %>...</option>
                                    <% }); %>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label fw-bold"><i class="fas fa-exclamation-triangle me-1"></i> Prioridade</label>
                                <select class="form-select">
                                    <option value="">Todas as Prioridades</option>
                                    <option value="Baixa">ğŸ“— Baixa</option>
                                    <option value="Media">ğŸ“˜ MÃ©dia</option>
                                    <option value="Alta">ğŸ“™ Alta</option>
                                    <option value="Urgente">ğŸ“• Urgente</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label fw-bold"><i class="fas fa-building me-1"></i> Departamento</label>
                                <select class="form-select">
                                    <option value="">Todos os Departamentos</option>
                                    <option value="Pedagogico">ğŸ“ PedagÃ³gico</option>
                                    <option value="Administrativo">ğŸ“Š Administrativo</option>
                                    <option value="ManutenÃ§Ã£o">ğŸ”§ ManutenÃ§Ã£o</option>
                                    <option value="Recursos Humanos">ğŸ‘¥ RH</option>
                                </select>
                            </div>
                        </div>

                        <!-- Tabela de Demandas -->
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>TÃ­tulo</th>
                                        <th>Escola</th>
                                        <th>Departamento</th>
                                        <th>Prioridade</th>
                                        <th>Status</th>
                                        <th>Prazo</th>
                                        <th class="text-center">AÃ§Ãµes</th>
                                    </tr>
                                </thead>
                                <tbody id="tabelaDemandas">
                                    <tr>
                                        <td colspan="7" class="text-center py-5">
                                            <div class="spinner-border text-primary" role="status">
                                                <span class="visually-hidden">Carregando...</span>
                                            </div>
                                            <p class="mt-3 text-muted">Carregando demandas...</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Nova Demanda -->
    <div class="modal fade" id="novaDemandaModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content border-0 shadow">
                <div class="modal-header">
                    <h5 class="modal-title text-white">
                        <i class="fas fa-plus-circle me-2"></i> Criar Nova Demanda
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4">
                    <form id="formNovaDemanda">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label fw-bold">
                                    <i class="fas fa-heading me-1"></i> TÃ­tulo *
                                </label>
                                <input type="text" class="form-control form-control-lg" name="titulo" required 
                                       placeholder="Ex: Reparo urgente na quadra esportiva">
                                <small class="form-text text-muted">Descreva brevemente a demanda</small>
                            </div>
                            
                            <div class="col-md-6">
                                <label class="form-label fw-bold">
                                    <i class="fas fa-school me-1"></i> Escola *
                                </label>
                                <select class="form-select form-select-lg" name="escola" required>
                                    <option value="" selected disabled>Selecione uma escola</option>
                                    <% escolas.forEach(function(escola) { %>
                                        <option value="<%= escola %>"><%= escola %></option>
                                    <% }); %>
                                </select>
                            </div>
                            
                            <div class="col-md-6">
                                <label class="form-label fw-bold">
                                    <i class="fas fa-building me-1"></i> Departamento *
                                </label>
                                <select class="form-select form-select-lg" name="departamento" required>
                                    <option value="" selected disabled>Selecione um departamento</option>
                                    <option value="Pedagogico">ğŸ“ PedagÃ³gico</option>
                                    <option value="Administrativo">ğŸ“Š Administrativo</option>
                                    <option value="ManutenÃ§Ã£o">ğŸ”§ ManutenÃ§Ã£o</option>
                                    <option value="Recursos Humanos">ğŸ‘¥ Recursos Humanos</option>
                                    <option value="AlimentaÃ§Ã£o">ğŸ AlimentaÃ§Ã£o</option>
                                    <option value="Transporte">ğŸšŒ Transporte</option>
                                    <option value="Outros">ğŸ“¦ Outros</option>
                                </select>
                            </div>
                            
                            <div class="col-md-6">
                                <label class="form-label fw-bold">
                                    <i class="fas fa-exclamation-triangle me-1"></i> Prioridade
                                </label>
                                <select class="form-select form-select-lg" name="prioridade">
                                    <option value="MÃ©dia" selected>ğŸ“˜ MÃ©dia (PadrÃ£o)</option>
                                    <option value="Baixa">ğŸ“— Baixa</option>
                                    <option value="Alta">ğŸ“™ Alta</option>
                                    <option value="Urgente">ğŸ“• Urgente</option>
                                </select>
                            </div>
                            
                            <div class="col-md-6">
                                <label class="form-label fw-bold">
                                    <i class="fas fa-calendar-alt me-1"></i> Prazo *
                                </label>
                                <input type="date" class="form-control form-control-lg" name="prazo" required 
                                       min="<%= new Date().toISOString().split('T')[0] %>">
                                <small class="form-text text-muted">Data limite para conclusÃ£o</small>
                            </div>
                            
                            <div class="col-md-6">
                                <label class="form-label fw-bold">
                                    <i class="fas fa-user me-1"></i> Solicitante
                                </label>
                                <input type="text" class="form-control form-control-lg" 
                                       value="<%= user.nome %>" readonly>
                                <small class="form-text text-muted">VocÃª estÃ¡ criando esta demanda</small>
                            </div>
                            
                            <div class="col-12">
                                <label class="form-label fw-bold">
                                    <i class="fas fa-align-left me-1"></i> DescriÃ§Ã£o Detalhada *
                                </label>
                                <textarea class="form-control" name="descricao" rows="5" required 
                                          placeholder="Descreva detalhadamente a demanda..."></textarea>
                                <small class="form-text text-muted">Quanto mais detalhes, melhor para o atendimento</small>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-1"></i> Cancelar
                    </button>
                    <button type="button" class="btn btn-primary btn-lg" onclick="criarDemanda()">
                        <i class="fas fa-save me-1"></i> Criar Demanda
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- INCLUI o rodapÃ© -->
    <%- include('partials/footer', {
        user: user,
        totalDemandas: totalDemandas
    }) %>

    <!-- INCLUI o botÃ£o PWA -->
    <%- include('partials/pwa-button') %>

    <!-- INCLUI os scripts -->
    <%- include('partials/scripts') %>

    <!-- Scripts especÃ­ficos da pÃ¡gina -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        console.log('âœ… PÃ¡gina de demandas carregada');
    });

    function criarDemanda() {
        alert('Funcionalidade serÃ¡ implementada em breve!');
    }
    </script>
</body>
</html>