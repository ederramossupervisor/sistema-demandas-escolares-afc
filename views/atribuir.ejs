<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <%- include('partials/head', {title: 'Atribuir Demandas - Sistema Escolar'}) %>
    
    <style>
        /* ADICIONAR ESTES ESTILOS NO IN√çCIO DA TAG <style> */
        .sidebar-desktop {
            position: sticky;
            top: 20px;
            height: fit-content;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .main-content {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
        }

        /* Para mobile, o sidebar some */
        @media (max-width: 767.98px) {
            .sidebar-desktop {
                display: none;
            }
        }
        /* Estilos espec√≠ficos para esta p√°gina */
        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }        
        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .card h2 {
            margin-top: 0;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        
        .demanda-item {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            transition: all 0.3s;
        }
        
        .demanda-item:hover {
            background: #e9ecef;
            transform: translateY(-2px);
        }
        
        .btn-atribuir {
            background: #2ecc71;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            float: right;
        }
        
        .btn-atribuir:hover {
            background: #27ae60;
        }
        
        .minhas-demandas {
            margin-top: 30px;
        }
        
        .status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status-pendente {
            background: #f39c12;
            color: white;
        }
        
        .status-andamento {
            background: #3498db;
            color: white;
        }
        
        .status-concluido {
            background: #2ecc71;
            color: white;
        }
        /* ==================== */
/* RESPONSIVIDADE MOBILE - ATRIBUIR DEMANDAS */
/* ==================== */
@media (max-width: 768px) {
    /* CONTAINER PRINCIPAL */
    .container-fluid {
        padding-left: 10px;
        padding-right: 10px;
    }
    
    /* CABE√áALHO */
    .card-body h1 {
        font-size: 1.6rem !important;
        margin-bottom: 10px !important;
    }
    
    .descricao {
        font-size: 0.95rem !important;
        line-height: 1.5 !important;
    }
    
    /* DASHBOARD - MUDAR DE 2 PARA 1 COLUNA */
    .dashboard {
        grid-template-columns: 1fr !important;
        gap: 25px !important;
        margin-bottom: 25px !important;
    }
    
    /* CARDS PRINCIPAIS */
    .card {
        padding: 20px 15px !important;
        border-radius: 15px !important;
        margin-bottom: 20px !important;
    }
    
    .card h2 {
        font-size: 1.3rem !important;
        padding-bottom: 8px !important;
        margin-bottom: 15px !important;
    }
    
    /* ==================== */
    /* LISTA DE USU√ÅRIOS - MOBILE OTIMIZADO */
    /* ==================== */
    .lista-usuarios {
        grid-template-columns: 1fr !important;
        gap: 15px !important;
        margin-top: 15px !important;
    }
    
    .usuario-card {
        padding: 20px !important;
        flex-direction: column !important;
        text-align: center !important;
        gap: 15px !important;
        min-height: auto !important;
    }
    
    .usuario-avatar {
        width: 60px !important;
        height: 60px !important;
        margin: 0 auto !important;
    }
    
    .avatar-inicial {
        font-size: 26px !important;
    }
    
    .usuario-nome {
        font-size: 1.1rem !important;
        margin-bottom: 8px !important;
    }
    
    .usuario-email {
        font-size: 0.9rem !important;
        margin-bottom: 12px !important;
        justify-content: center !important;
    }
    
    .usuario-tipo-badge {
        padding: 8px 14px !important;
        font-size: 12px !important;
        margin: 0 auto 15px auto !important;
        display: inline-flex !important;
        width: auto !important;
    }
    
    /* BOT√ÉO SELECIONAR MAIOR */
    .btn-selecionar-card {
        padding: 14px 20px !important;
        font-size: 15px !important;
        min-height: 48px;
        width: 100% !important;
        justify-content: center !important;
        margin-top: 10px !important;
    }
    
    .btn-text {
        font-size: 14px !important;
    }
    
    /* ==================== */
    /* LISTA DE DEMANDAS - MOBILE OTIMIZADO */
    /* ==================== */
    .lista-demandas {
        grid-template-columns: 1fr !important;
        gap: 20px !important;
        margin-top: 15px !important;
    }
    
    .demanda-card {
        padding: 20px !important;
        border-radius: 15px !important;
    }
    
    .demanda-header {
        flex-direction: column !important;
        text-align: center !important;
        gap: 12px !important;
        margin-bottom: 15px !important;
    }
    
    .demanda-icon {
        width: 50px !important;
        height: 50px !important;
        margin: 0 auto !important;
        font-size: 24px !important;
    }
    
    .demanda-title {
        font-size: 1.2rem !important;
        line-height: 1.4 !important;
    }
    
    .demanda-descricao {
        font-size: 14px !important;
        line-height: 1.5 !important;
        padding: 12px !important;
        margin-bottom: 15px !important;
    }
    
    .demanda-metadata {
        grid-template-columns: 1fr !important;
        gap: 12px !important;
        padding: 12px !important;
        margin-bottom: 20px !important;
    }
    
    .metadata-item {
        justify-content: center !important;
        font-size: 13px !important;
    }
    
    /* RODAP√â DA DEMANDA - REORGANIZAR */
    .demanda-footer {
        flex-direction: column !important;
        gap: 15px !important;
        text-align: center !important;
        padding-top: 15px !important;
    }
    
    /* BOT√ÉO ATRIBUIR MAIOR */
    .demanda-btn, .btn-atribuir {
        padding: 16px 24px !important;
        font-size: 15px !important;
        min-height: 50px;
        width: 100% !important;
        justify-content: center !important;
        margin: 0 !important;
    }
    
    /* ==================== */
    /* MINHAS DEMANDAS ATRIBU√çDAS */
    /* ==================== */
    .minhas-demandas {
        margin-top: 25px !important;
    }
    
    .minhas-demandas h2 {
        font-size: 1.3rem !important;
    }
    
    /* ==================== */
    /* MENSAGENS E ALERTAS */
    /* ==================== */
    #msg-usuario-selecionado {
        padding: 12px 15px !important;
        font-size: 14px !important;
        margin: 10px 0 !important;
    }
    
    /* ==================== */
    /* BOT√ïES GERAIS */
    /* ==================== */
    .btn {
        padding: 14px 20px !important;
        font-size: 15px !important;
        min-height: 48px;
        min-width: 120px; /* Largura m√≠nima para toque */
    }
    
    /* REMOVER HOVER EFFECTS EM TOUCH */
    .btn:hover,
    .usuario-card:hover,
    .demanda-card:hover {
        transform: none !important;
    }
    
    .btn:active {
        transform: scale(0.98) !important; /* Feedback de toque */
    }
}

/* ==================== */
/* CELULARES MUITO PEQUENOS (375px) */
/* ==================== */
@media (max-width: 375px) {
    .container-fluid {
        padding-left: 8px !important;
        padding-right: 8px !important;
    }
    
    .card {
        padding: 18px 12px !important;
    }
    
    .usuario-card {
        padding: 18px !important;
    }
    
    .usuario-avatar {
        width: 55px !important;
        height: 55px !important;
    }
    
    .avatar-inicial {
        font-size: 24px !important;
    }
    
    .btn-selecionar-card,
    .demanda-btn,
    .btn-atribuir {
        padding: 14px 18px !important;
        font-size: 14px !important;
        min-height: 46px;
    }
    
    .demanda-card {
        padding: 18px !important;
    }
    
    .demanda-title {
        font-size: 1.1rem !important;
    }
    
    .demanda-descricao {
        font-size: 13px !important;
        padding: 10px !important;
    }
}

/* ==================== */
/* MELHORIAS DE ACESSIBILIDADE */
/* ==================== */
/* Feedback visual para toque */
.usuario-card:active,
.demanda-card:active {
    transform: scale(0.98) !important;
    transition: transform 0.1s !important;
}

/* Garantir que textos n√£o sejam muito pequenos */
.usuario-email,
.demanda-descricao,
.metadata-text {
    font-size: 14px !important;
    line-height: 1.5 !important;
}

/* Espa√ßamento entre elementos para toque f√°cil */
.usuario-card,
.demanda-card {
    margin-bottom: 12px !important;
}

/* Melhor contraste para sele√ß√£o */
.usuario-card.selecionado {
    border-width: 3px !important;
    border-color: #2ecc71 !important;
    box-shadow: 0 0 0 3px rgba(46, 204, 113, 0.2) !important;
}

/* Indicador visual para cards selecionados */
.usuario-card.selecionado::after {
    content: "‚úì SELECIONADO";
    position: absolute;
    top: 10px;
    right: 10px;
    background: #2ecc71;
    color: white;
    padding: 4px 8px;
    border-radius: 10px;
    font-size: 10px;
    font-weight: bold;
}

/* Ajuste para n√£o sobrepor em mobile */
@media (max-width: 768px) {
    .usuario-card.selecionado::after {
        top: 5px;
        right: 5px;
        font-size: 9px;
        padding: 3px 6px;
    }
}
    </style>
</head>
<body>
    <!-- INCLUI a navbar do sistema -->
    <%- include('partials/navbar') %>

    <!-- =========================================== -->
    <!-- CONTAINER PRINCIPAL -->
    <!-- =========================================== -->
    <!-- CONTAINER PRINCIPAL SIMPLIFICADO -->
                <div class="container-fluid mt-4">
                    <div class="row">
                        
                        <!-- =========================================== -->
                        <!-- SIDEBAR UNIFICADA - Vis√≠vel apenas no desktop -->
                        <!-- =========================================== -->
                        <div class="col-md-3 d-none d-md-block">
                            <div class="card border-0 shadow-sm mb-4">
                                <div class="card-body p-3">
                                    <%- include('partials/sidebar', { 
                                        currentPage: 'atribuir', 
                                        user: user,
                                        escolas: escolas || []
                                    }); %>
                                </div>
                            </div>
                        </div>
                        
                        <!-- =========================================== -->
                        <!-- CONTE√öDO PRINCIPAL (9 colunas) -->
                        <!-- =========================================== -->
                        <div class="col-md-9">
                            
                                           
                            <!-- Conte√∫do da p√°gina -->
                            <div class="card">
                                <div class="card-body">
                                    <h1>üë• Atribui√ß√£o de Demandas</h1>
                                    <p class="descricao">Aqui voc√™ pode atribuir demandas n√£o atribu√≠das para outros usu√°rios e ver as demandas atribu√≠das para voc√™.</p>
                                    
                                    <div class="dashboard">
                                        <!-- Coluna 1: Demandas n√£o atribu√≠das -->
                                        <div class="card">
                                            <h2>üì• Demandas N√£o Atribu√≠das</h2>
                                            <div id="demandas-nao-atribuidas">
                                                <p>Carregando demandas n√£o atribu√≠das...</p>
                                            </div>
                                        </div>
                                        
                                        <!-- Coluna 2: Usu√°rios dispon√≠veis -->
                                        <div class="card">
                                            <h2>üë§ Usu√°rios Dispon√≠veis</h2>
                                            <div id="usuarios-disponiveis">
                                                <p>Carregando usu√°rios...</p>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Minhas demandas atribu√≠das -->
                                    <div class="card minhas-demandas">
                                        <h2>üìã Minhas Demandas Atribu√≠das</h2>
                                        <div id="minhas-demandas">
                                            <p>Carregando minhas demandas...</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                    </div>
                </div>
          
                
    <!-- INCLUI o rodap√© -->
    <%- include('partials/footer', {
        user: user,
        totalDemandas: totalDemandas || 0
    }) %>
    
    <!-- INCLUI o bot√£o PWA -->
    <%- include('partials/pwa-button') %>

    <script>
        // Aviso inicial
        console.log("üîß P√°gina de atribui√ß√£o carregada!");
        console.log("üì° Conectando √† API...");
        
        // Fun√ß√£o para carregar dados da API
        async function carregarDados() {
            try {
                console.log("üîÑ Iniciando carregamento de dados...");
                
                // Vamos carregar os dados em etapas
                await carregarUsuarios();
                await carregarDemandasNaoAtribuidas();
                await carregarMinhasDemandas();
                
                console.log("‚úÖ Todos os dados carregados com sucesso!");
            } catch (erro) {
                console.error("‚ùå Erro ao carregar dados:", erro);
                alert("Erro ao carregar dados. Verifique o console para detalhes.");
            }
        }
        
        // Fun√ß√£o para carregar usu√°rios (VERS√ÉO CORRIGIDA)
        async function carregarUsuarios() {
            console.log("üë§ Carregando usu√°rios...");
            
            try {
                // Fazer requisi√ß√£o para a API de teste
                const resposta = await fetch('/usuarios-teste');
                
                if (!resposta.ok) {
                    throw new Error(`Erro HTTP: ${resposta.status}`);
                }
                
                const dados = await resposta.json();
                console.log("üì¶ Dados recebidos:", dados);
                
                // VERIFICAR DIFERENTES ESTRUTURAS DE RESPOSTA
                let usuarios = [];
                
                if (Array.isArray(dados)) {
                    // Se a resposta j√° √© um array
                    usuarios = dados;
                } else if (dados.usuarios && Array.isArray(dados.usuarios)) {
                    // Se tem propriedade "usuarios" que √© array
                    usuarios = dados.usuarios;
                } else if (dados.data && Array.isArray(dados.data)) {
                    // Se tem propriedade "data" que √© array
                    usuarios = dados.data;
                } else {
                    // Se n√£o for nenhum dos formatos esperados
                    console.warn("‚ö†Ô∏è Formato de resposta inesperado:", dados);
                    usuarios = [];
                }
                
                console.log(`‚úÖ ${usuarios.length} usu√°rios carregados`);
                
                // Exibir usu√°rios na p√°gina
                const container = document.getElementById('usuarios-disponiveis');
                
                if (usuarios.length === 0) {
                    container.innerHTML = '<p>Nenhum usu√°rio dispon√≠vel.</p>';
                    return;
                }
                
                let html = '<div class="lista-usuarios">';
                
                usuarios.forEach(usuario => {
                    // Garantir que temos os campos necess√°rios
                    const usuarioId = usuario._id || usuario.id || 'sem-id';
                    const usuarioNome = usuario.nome || 'Usu√°rio sem nome';
                    const usuarioEmail = usuario.email || 'Sem e-mail';
                    const usuarioTipo = usuario.tipo || 'N√£o definido';
                    
                    html += `
                        <div class="usuario-card" onclick="selecionarUsuarioCard(this)" data-id="${usuarioId}" data-nome="${usuarioNome}" data-tipo="${usuarioTipo}">
                            
                            <!-- C√çRCULO COM LETRA INICIAL MELHORADO -->
                            <div class="usuario-avatar ${usuarioTipo.toLowerCase()}">
                                <span class="avatar-inicial" style="color: white; text-shadow: 0 2px 4px rgba(0,0,0,0.3);">${usuarioNome.charAt(0).toUpperCase()}</span>
                                <div class="avatar-badge">
                                    ${usuarioTipo === 'admin' || usuarioTipo === 'administrador' ? 'üëë' : 'üë§'}
                                </div>
                            </div>
                            
                            <!-- INFORMA√á√ïES DO USU√ÅRIO -->
                            <div class="usuario-info">
                                <h3 class="usuario-nome">${usuarioNome}</h3>
                                <p class="usuario-email" style="color: #4a5568;">
                                    <i class="fas fa-envelope"></i> ${usuarioEmail}
                                </p>
                                
                                <!-- BADGE DO TIPO COLORIDO -->
                                <div class="usuario-tipo-badge ${usuarioTipo.toLowerCase()}">
                                    <i class="fas fa-${usuarioTipo === 'admin' || usuarioTipo === 'administrador' ? 'crown' : 'user'}"></i>
                                    ${usuarioTipo === 'admin' ? 'Administrador' : 
                                    usuarioTipo === 'administrador' ? 'Administrador' : 
                                    usuarioTipo === 'professor' ? 'Professor' :
                                    usuarioTipo === 'coordenador' ? 'Coordenador' :
                                    usuarioTipo.charAt(0).toUpperCase() + usuarioTipo.slice(1)}
                                </div>
                            </div>
                            
                            <!-- BOT√ÉO DE SELE√á√ÉO -->
                            <button class="btn-selecionar-card" data-id="${usuarioId}" data-nome="${usuarioNome}">
                                <span class="btn-icon">üëÜ</span>
                                <span class="btn-text">Selecionar</span>
                            </button>
                            
                            <!-- INDICADOR DE SELE√á√ÉO (ESCONDIDO POR PADR√ÉO) -->
                            <div class="selecionado-indicator">
                                <i class="fas fa-check-circle"></i>
                            </div>
                        </div>
                    `;
                });
                
                html += '</div>';
                container.innerHTML = html;
                
                // Adicionar estilos para os itens de usu√°rio
                const style = document.createElement('style');
                style.textContent = `
                        .lista-usuarios {
                            display: grid;
                            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
                            gap: 25px;
                            margin-top: 20px;
                        }
                        
                        .usuario-card {
                            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
                            border: 2px solid #e3e6f0;
                            border-radius: 16px;
                            padding: 25px;
                            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.1);
                            cursor: pointer;
                            display: flex;
                            align-items: center;
                            gap: 20px;
                            position: relative;
                            overflow: hidden;
                            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
                        }
                        
                        .usuario-card:hover {
                            transform: translateY(-8px);
                            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
                            border-color: #4dabf7;
                            background: linear-gradient(135deg, #ffffff 0%, #e7f3ff 100%);
                        }
                        
                        .usuario-card.selecionado {
                            border-color: #40c057;
                            background: linear-gradient(135deg, #f0fff4 0%, #d3f9d8 100%);
                            transform: translateY(-5px);
                            box-shadow: 0 10px 25px rgba(64, 192, 87, 0.2);
                        }
                        
                        /* AVATAR MELHORADO */
                        .usuario-avatar {
                            width: 70px;
                            height: 70px;
                            border-radius: 50%;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            font-weight: bold;
                            color: white;
                            flex-shrink: 0;
                            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
                            position: relative;
                            transition: all 0.3s ease;
                        }
                        
                        .avatar-inicial {
                            font-size: 32px;
                            font-weight: 800;
                            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
                            color: #000000 !important;
                        }
                        
                        /* BADGE NO AVATAR (√çCONE PEQUENO) */
                        .avatar-badge {
                            position: absolute;
                            bottom: -5px;
                            right: -5px;
                            background: white;
                            width: 28px;
                            height: 28px;
                            border-radius: 50%;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            font-size: 14px;
                            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);
                            border: 2px solid white;
                        }
                        
                        /* CORES DO AVATAR POR TIPO */
                        .usuario-avatar.professor { background: linear-gradient(135deg, #4299e1, #3182ce); }
                        .usuario-avatar.coordenador { background: linear-gradient(135deg, #9f7aea, #805ad5); }
                        .usuario-avatar.diretor { background: linear-gradient(135deg, #f56565, #e53e3e); }
                        .usuario-avatar.administrador { background: linear-gradient(135deg, #38b2ac, #319795); }
                        .usuario-avatar.secretario { background: linear-gradient(135deg, #ed8936, #dd6b20); }
                        .usuario-avatar.teste { background: linear-gradient(135deg, #a0aec0, #718096); }
                        .usuario-avatar.coordenadora { background: linear-gradient(135deg, #d53f8c, #b83280); }
                        .usuario-avatar.professora { background: linear-gradient(135deg, #4299e1, #3182ce); }
                        .usuario-avatar.nao-definido { background: linear-gradient(135deg, #a0aec0, #718096); }
                        
                        /* INFORMA√á√ïES DO USU√ÅRIO */
                        .usuario-info {
                            flex: 1;
                            min-width: 0; /* Permite quebra de texto */
                        }
                        
                        .usuario-nome {
                            margin: 0 0 8px 0;
                            color: #2d3748;
                            font-size: 18px;
                            font-weight: 700;
                            white-space: nowrap;
                            overflow: hidden;
                            text-overflow: ellipsis;
                        }
                        
                        .usuario-email {
                            margin: 0 0 12px 0;
                            color: #000000 !important;
                            font-size: 14px;
                            display: flex;
                            align-items: center;
                            gap: 8px;
                        }
                        
                        .usuario-email i {
                            color: #4299e1;
                            font-size: 12px;
                        }
                        
                        /* BADGE DO TIPO (NOVA VERS√ÉO) */
                        .usuario-tipo-badge {
                            display: inline-flex;
                            align-items: center;
                            gap: 8px;
                            padding: 8px 16px;
                            border-radius: 20px;
                            font-size: 13px;
                            font-weight: 700;
                            color: #000000 !important;
                            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
                            transition: all 0.3s;
                        }
                        
                        .usuario-tipo-badge i {
                            font-size: 11px;
                        }
                        
                        /* CORES DOS BADGES POR TIPO */
                        .usuario-tipo-badge.professor { background: linear-gradient(135deg, #4299e1, #3182ce); }
                        .usuario-tipo-badge.coordenador { background: linear-gradient(135deg, #9f7aea, #805ad5); }
                        .usuario-tipo-badge.diretor { background: linear-gradient(135deg, #f56565, #e53e3e); }
                        .usuario-tipo-badge.administrador { background: linear-gradient(135deg, #38b2ac, #319795); }
                        .usuario-tipo-badge.secretario { background: linear-gradient(135deg, #ed8936, #dd6b20); }
                        .usuario-tipo-badge.nao-definido { background: linear-gradient(135deg, #a0aec0, #718096); }
                        .usuario-tipo-badge.coordenadora { background: linear-gradient(135deg, #d53f8c, #b83280); }
                        .usuario-tipo-badge.professora { background: linear-gradient(135deg, #4299e1, #3182ce); }
                        
                        /* BOT√ÉO DE SELE√á√ÉO */
                        .btn-selecionar-card {
                            background: linear-gradient(135deg, #4dabf7, #339af0);
                            color: white;
                            border: none;
                            padding: 12px 20px;
                            border-radius: 12px;
                            cursor: pointer;
                            font-size: 14px;
                            font-weight: 700;
                            display: flex;
                            align-items: center;
                            gap: 10px;
                            transition: all 0.3s;
                            flex-shrink: 0;
                            box-shadow: 0 4px 12px rgba(77, 171, 247, 0.3);
                        }
                        
                        .btn-selecionar-card:hover {
                            background: linear-gradient(135deg, #339af0, #228be6);
                            transform: translateY(-2px);
                            box-shadow: 0 6px 16px rgba(77, 171, 247, 0.4);
                        }
                        
                        .usuario-card.selecionado .btn-selecionar-card {
                            background: linear-gradient(135deg, #40c057, #37b24d);
                            box-shadow: 0 4px 12px rgba(64, 192, 87, 0.3);
                        }
                        
                        .btn-icon {
                            font-size: 16px;
                        }
                        
                        .btn-text {
                            white-space: nowrap;
                        }
                        
                        /* INDICADOR DE SELE√á√ÉO (ESCONDIDO POR PADR√ÉO) */
                        .selecionado-indicator {
                            position: absolute;
                            top: 15px;
                            right: 15px;
                            color: #40c057;
                            font-size: 20px;
                            opacity: 0;
                            transform: scale(0);
                            transition: all 0.3s ease;
                        }
                        
                        .usuario-card.selecionado .selecionado-indicator {
                            opacity: 1;
                            transform: scale(1);
                        }
                        
                        /* EFEITO DE SELE√á√ÉO (BORDA SUPERIOR) */
                        .usuario-card::before {
                            content: '';
                            position: absolute;
                            top: 0;
                            left: 0;
                            right: 0;
                            height: 5px;
                            background: transparent;
                            transition: background 0.3s;
                            border-radius: 16px 16px 0 0;
                        }
                        
                        .usuario-card.selecionado::before {
                            background: linear-gradient(90deg, #40c057, #51cf66);
                        }
                        
                        /* ANIMA√á√ïES */
                        @keyframes pulse {
                            0% { box-shadow: 0 0 0 0 rgba(64, 192, 87, 0.4); }
                            70% { box-shadow: 0 0 0 12px rgba(64, 192, 87, 0); }
                            100% { box-shadow: 0 0 0 0 rgba(64, 192, 87, 0); }
                        }
                        
                        .usuario-card.selecionado {
                            animation: pulse 2s infinite;
                        }
                        
                        @keyframes float {
                            0%, 100% { transform: translateY(0px); }
                            50% { transform: translateY(-10px); }
                        }
                        
                        .usuario-card:hover {
                            animation: float 3s ease-in-out infinite;
                        }
                        
                        /* RESPONSIVIDADE */
                        @media (max-width: 768px) {
                            .lista-usuarios {
                                grid-template-columns: 1fr;
                                gap: 15px;
                            }
                            
                            .usuario-card {
                                flex-direction: column;
                                text-align: center;
                                padding: 20px;
                                gap: 15px;
                            }
                            
                            .usuario-info {
                                margin: 10px 0;
                            }
                            
                            .usuario-nome {
                                font-size: 16px;
                            }
                            
                            .btn-selecionar-card {
                                width: 100%;
                                justify-content: center;
                            }
                            
                            .usuario-avatar {
                                width: 60px;
                                height: 60px;
                            }
                            
                            .avatar-inicial {
                                font-size: 28px;
                            }
                        }
                        
                        /* EFEITO DE CARREGAMENTO (OPCIONAL) */
                        @keyframes shimmer {
                            0% { background-position: -200px 0; }
                            100% { background-position: 200px 0; }
                        }
                        
                        .usuario-card.loading {
                            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
                            background-size: 200px 100%;
                            animation: shimmer 1.5s infinite;
                        }
                    }
                `;
                document.head.appendChild(style);
                
            } catch (erro) {
                console.error("‚ùå Erro ao carregar usu√°rios:", erro);
                document.getElementById('usuarios-disponiveis').innerHTML = `
                    <div style="color: red; padding: 20px; border: 2px solid red; border-radius: 5px;">
                        <p><strong>Erro ao carregar usu√°rios:</strong> ${erro.message}</p>
                        <p>Usando dados de exemplo para continuar...</p>
                    </div>
                `;
                
                // Carregar dados de exemplo em caso de erro
                carregarUsuariosExemplo();
            }
        }

        // Fun√ß√£o de fallback com dados de exemplo
        function carregarUsuariosExemplo() {
            const usuariosExemplo = [
                { id: 1, nome: 'Jo√£o (Exemplo)', email: 'joao@exemplo.com', tipo: 'professor' },
                { id: 2, nome: 'Maria (Exemplo)', email: 'maria@exemplo.com', tipo: 'coordenadora' },
                { id: 3, nome: 'Carlos (Exemplo)', email: 'carlos@exemplo.com', tipo: 'diretor' }
            ];
            
            const container = document.getElementById('usuarios-disponiveis');
            let html = '<div class="lista-usuarios">';
            
            usuariosExemplo.forEach(usuario => {
                html += `
                    <div class="usuario-item">
                        <strong>üë§ ${usuario.nome}</strong>
                        <p><small>${usuario.email}</small></p>
                        <p><small>Tipo: ${usuario.tipo}</small></p>
                        <button class="btn-selecionar" data-id="${usuario.id}" data-nome="${usuario.nome}">
                            Selecionar
                        </button>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        // üîß FUN√á√ÉO ATUALIZADA: Carregar demandas n√£o atribu√≠das da API REAL
        async function carregarDemandasNaoAtribuidas() {
            console.log("üì• CONECTANDO √Ä API REAL: Buscando demandas n√£o atribu√≠das...");
            
            const container = document.getElementById('demandas-nao-atribuidas');
            
            try {
                // üì° PASSO 1: Mostrar carregamento
                container.innerHTML = `
                    <div style="text-align: center; padding: 30px;">
                        <div style="font-size: 24px;">üîÑ</div>
                        <p>Conectando ao servidor...</p>
                        <p><small>Aguarde enquanto buscamos as demandas reais</small></p>
                    </div>
                `;
                
                // üì° PASSO 2: Fazer requisi√ß√£o para a API REAL
                console.log("üåê Fazendo requisi√ß√£o para: /api/demandas?status=pendente");
                const resposta = await fetch('/api/demandas?status=pendente');
                
                if (!resposta.ok) {
                    throw new Error(`API respondeu com erro ${resposta.status}`);
                }
                
                const dados = await resposta.json();
                console.log("‚úÖ RESPOSTA DA API REAL:", dados);
                
                // üì° PASSO 3: VERIFICAR SE TEM DADOS
                if (!dados || !dados.success) {
                    throw new Error(`API n√£o retornou dados v√°lidos: ${dados?.message || 'Erro desconhecido'}`);
                }
                
                // üì° PASSO 4: FILTRAR APENAS DEMANDAS N√ÉO ATRIBU√çDAS
                // A API real retorna demandas onde 'responsavel' √© null ou n√£o existe
                let demandasNaoAtribuidas = [];
                
                if (dados.data && Array.isArray(dados.data)) {
                    demandasNaoAtribuidas = dados.data.filter(demanda => {
                        // Demanda n√£o atribu√≠da = n√£o tem respons√°vel OU respons√°vel √© null/vazio
                        return !demanda.responsavel || 
                               !demanda.responsavel.id || 
                               demanda.responsavel.id === null;
                    });
                } else if (Array.isArray(dados)) {
                    // Se a resposta for um array direto (formato antigo)
                    demandasNaoAtribuidas = dados.filter(demanda => 
                        !demanda.responsavel || !demanda.responsavel.id
                    );
                }
                
                console.log(`üéØ ${demandasNaoAtribuidas.length} DEMANDAS REAIS N√ÉO ATRIBU√çDAS ENCONTRADAS`);
                
                // üì° PASSO 5: EXIBIR AS DEMANDAS REAIS
                if (demandasNaoAtribuidas.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 40px; background: #f8f9fa; border-radius: 10px;">
                            <div style="font-size: 48px; margin-bottom: 20px;">üéâ</div>
                            <h3 style="color: #2ecc71;">Tudo em dia!</h3>
                            <p>N√£o h√° demandas pendentes para atribuir no momento.</p>
                            <p><small>As demandas da API real foram carregadas com sucesso!</small></p>
                        </div>
                    `;
                    return;
                }
                
                // üì° PASSO 6: CRIAR HTML COM AS DEMANDAS REAIS
                let html = '<div class="lista-demandas">';
                
                demandasNaoAtribuidas.forEach(demanda => {
                    // üè∑Ô∏è DADOS DA API REAL
                    const demandaId = demanda._id || demanda.id || 'sem-id';
                    const demandaTitulo = demanda.titulo || 'Demanda sem t√≠tulo';
                    const demandaDescricao = demanda.descricao || 'Sem descri√ß√£o dispon√≠vel';
                    const demandaPrioridade = demanda.prioridade || 'M√©dia';
                    const dataCriacao = demanda.criadoEm ? 
                        new Date(demanda.criadoEm).toLocaleDateString('pt-BR') : 
                        'Data n√£o informada';
                    
                    // üè´ ESCOLA (dado real da API)
                    const escola = demanda.escola || 'Escola n√£o especificada';
                    
                    // üé® COR BASEADA NA PRIORIDADE REAL
                    let corPrioridade = '#f39c12'; // m√©dia (padr√£o)
                    if (demandaPrioridade.toLowerCase() === 'alta') corPrioridade = '#e74c3c';
                    if (demandaPrioridade.toLowerCase() === 'urgente') corPrioridade = '#c0392b';
                    if (demandaPrioridade.toLowerCase() === 'baixa') corPrioridade = '#2ecc71';
                    
                    html += `
                    <div class="demanda-card" id="demanda-${demandaId}">
                        
                        <!-- CABE√áALHO COM √çCONE E T√çTULO -->
                        <div class="demanda-header">
                            <div class="demanda-icon">
                                ${demandaPrioridade.toLowerCase() === 'urgente' ? 'üö®' : 
                                demandaPrioridade.toLowerCase() === 'alta' ? 'üî•' : 
                                demandaPrioridade.toLowerCase() === 'media' ? '‚ö°' : 'üìã'}
                            </div>
                            <div class="demanda-title-section">
                                <h3 class="demanda-title">${demandaTitulo}</h3>
                                <div class="demanda-status ${demandaPrioridade.toLowerCase()}">
                                    <span class="status-dot"></span>
                                    ${demandaPrioridade.toUpperCase()}
                                </div>
                            </div>
                        </div>
                        
                        <!-- DESCRI√á√ÉO -->
                        <p class="demanda-descricao">${demandaDescricao}</p>
                        
                        <!-- METADADOS (ESCOLA, DATA, ETC) -->
                        <div class="demanda-metadata">
                            <div class="metadata-item">
                                <i class="fas fa-school"></i>
                                <span class="metadata-text" title="${escola}">
                                    ${escola.substring(0, 25)}${escola.length > 25 ? '...' : ''}
                                </span>
                            </div>
                            
                            <div class="metadata-item">
                                <i class="fas fa-calendar-alt"></i>
                                <span class="metadata-text">${dataCriacao}</span>
                            </div>
                            
                            <div class="metadata-item">
                                <i class="fas fa-clock"></i>
                                <span class="metadata-text">${demandaPrioridade.toLowerCase() === 'urgente' ? 'Urgente' : 
                                                        demandaPrioridade.toLowerCase() === 'alta' ? 'Alta Prioridade' : 
                                                        demandaPrioridade.toLowerCase() === 'media' ? 'Prioridade M√©dia' : 
                                                        'Prioridade Baixa'}</span>
                            </div>
                        </div>
                        
                        <!-- RODAP√â COM BOT√ÉO -->
                        <div class="demanda-footer">
                            <div class="demanda-id">
                                <small>ID: ${demandaId.substring(0, 8)}...</small>
                            </div>
                            
                            <button 
                                class="btn-atribuir demanda-btn" 
                                data-id="${demandaId}"
                                data-titulo="${demandaTitulo.replace(/"/g, '&quot;')}"
                                onclick="atribuirDemanda('${demandaId}', '${demandaTitulo.replace(/'/g, "\\'")}')">
                                <i class="fas fa-user-check"></i>
                                Atribuir Demanda
                            </button>
                        </div>
                        
                        <!-- BARRA DE PRIORIDADE (COR DIN√ÇMICA) -->
                        <div class="prioridade-bar" style="background: ${corPrioridade};"></div>
                    </div>
                `;
                });
                
                html += '</div>';
                container.innerHTML = html;
                
                // üì° PASSO 7: ADICIONAR ESTILOS ESPEC√çFICOS
                                const estiloExtra = document.createElement('style');
                estiloExtra.textContent = `
                    /* CONTAINER PRINCIPAL DAS DEMANDAS */
                    .lista-demandas {
                        display: grid;
                        grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
                        gap: 25px;
                        margin-top: 20px;
                    }
                    
                    /* CARD DE DEMANDA COMPLETO */
                    .demanda-card {
                        background: linear-gradient(135deg, #ffffff 0%, #fdfdfe 100%);
                        border: 2px solid #eef2f7;
                        border-radius: 18px;
                        padding: 25px;
                        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.1);
                        position: relative;
                        overflow: hidden;
                        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.06);
                    }
                    
                    .demanda-card:hover {
                        transform: translateY(-8px);
                        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
                        border-color: #d0e1f9;
                    }
                    
                    /* CABE√áALHO DA DEMANDA */
                    .demanda-header {
                        display: flex;
                        align-items: flex-start;
                        gap: 15px;
                        margin-bottom: 20px;
                    }
                    
                    .demanda-icon {
                        font-size: 28px;
                        background: linear-gradient(135deg, #4dabf7, #339af0);
                        color: white;
                        width: 50px;
                        height: 50px;
                        border-radius: 12px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        flex-shrink: 0;
                        box-shadow: 0 6px 12px rgba(77, 171, 247, 0.3);
                    }
                    
                    .demanda-title-section {
                        flex: 1;
                        min-width: 0;
                    }
                    
                    .demanda-title {
                        margin: 0 0 8px 0;
                        color: #2d3748;
                        font-size: 18px;
                        font-weight: 800;
                        line-height: 1.4;
                        word-break: break-word;
                    }
                    
                    /* STATUS DA DEMANDA */
                    .demanda-status {
                        display: inline-flex;
                        align-items: center;
                        gap: 8px;
                        padding: 6px 14px;
                        border-radius: 20px;
                        font-size: 12px;
                        font-weight: 800;
                        color: white;
                        text-transform: uppercase;
                        letter-spacing: 0.5px;
                        box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
                    }
                    
                    .status-dot {
                        width: 8px;
                        height: 8px;
                        border-radius: 50%;
                        background: white;
                        display: inline-block;
                        animation: pulse-dot 2s infinite;
                    }
                    
                    /* CORES DO STATUS POR PRIORIDADE */
                    .demanda-status.urgente {
                        background: linear-gradient(135deg, #ff6b6b, #fa5252);
                    }
                    
                    .demanda-status.alta {
                        background: linear-gradient(135deg, #ff922b, #f76707);
                    }
                    
                    .demanda-status.media {
                        background: linear-gradient(135deg, #ffd43b, #fcc419);
                        color: #2d3748;
                    }
                    
                    .demanda-status.media .status-dot {
                        background: #2d3748;
                    }
                    
                    .demanda-status.baixa {
                        background: linear-gradient(135deg, #51cf66, #40c057);
                    }
                    
                    /* DESCRI√á√ÉO */
                    .demanda-descricao {
                        color: #4a5568;
                        font-size: 14.5px;
                        line-height: 1.6;
                        margin: 0 0 20px 0;
                        padding: 15px;
                        background: #f8fafc;
                        border-radius: 10px;
                        border-left: 4px solid #4dabf7;
                    }
                    
                    /* METADADOS */
                    .demanda-metadata {
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                        gap: 15px;
                        margin-bottom: 25px;
                        padding: 15px;
                        background: #f1f5f9;
                        border-radius: 10px;
                    }
                    
                    .metadata-item {
                        display: flex;
                        align-items: center;
                        gap: 10px;
                        color: #64748b;
                        font-size: 13.5px;
                    }
                    
                    .metadata-item i {
                        color: #4dabf7;
                        font-size: 14px;
                        width: 20px;
                        text-align: center;
                    }
                    
                    .metadata-text {
                        overflow: hidden;
                        text-overflow: ellipsis;
                        white-space: nowrap;
                    }
                    
                    /* RODAP√â */
                    .demanda-footer {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        padding-top: 20px;
                        border-top: 2px dashed #e2e8f0;
                    }
                    
                    .demanda-id {
                        color: #94a3b8;
                        font-size: 12px;
                        font-family: 'Courier New', monospace;
                        background: #f1f5f9;
                        padding: 5px 10px;
                        border-radius: 6px;
                    }
                    
                    /* BOT√ÉO DE ATRIBUIR */
                    .demanda-btn {
                        background: linear-gradient(135deg, #4dabf7, #339af0);
                        color: white;
                        border: none;
                        padding: 14px 24px;
                        border-radius: 12px;
                        cursor: pointer;
                        font-weight: 700;
                        font-size: 14px;
                        display: flex;
                        align-items: center;
                        gap: 10px;
                        transition: all 0.3s;
                        box-shadow: 0 6px 15px rgba(77, 171, 247, 0.3);
                    }
                    
                    .demanda-btn:hover {
                        background: linear-gradient(135deg, #339af0, #228be6);
                        transform: translateY(-3px);
                        box-shadow: 0 10px 20px rgba(77, 171, 247, 0.4);
                    }
                    
                    .demanda-btn i {
                        font-size: 16px;
                    }
                    
                    /* BARRA DE PRIORIDADE LATERAL */
                    .prioridade-bar {
                        position: absolute;
                        top: 0;
                        left: 0;
                        bottom: 0;
                        width: 6px;
                        border-radius: 18px 0 0 18px;
                        transition: all 0.3s;
                    }
                    
                    .demanda-card:hover .prioridade-bar {
                        width: 8px;
                    }
                    
                    /* ANIMA√á√ïES */
                    @keyframes pulse-dot {
                        0%, 100% { opacity: 1; }
                        50% { opacity: 0.5; }
                    }
                    
                    @keyframes slide-in {
                        from { transform: translateX(-20px); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    
                    .demanda-card {
                        animation: slide-in 0.5s ease-out;
                    }
                    
                    @keyframes float-card {
                        0%, 100% { transform: translateY(0); }
                        50% { transform: translateY(-10px); }
                    }
                    
                    .demanda-card:hover {
                        animation: float-card 3s ease-in-out infinite;
                    }
                    
                    /* RESPONSIVIDADE */
                    @media (max-width: 768px) {
                        .lista-demandas {
                            grid-template-columns: 1fr;
                            gap: 20px;
                        }
                        
                        .demanda-card {
                            padding: 20px;
                        }
                        
                        .demanda-header {
                            flex-direction: column;
                            text-align: center;
                            gap: 10px;
                        }
                        
                        .demanda-icon {
                            margin: 0 auto;
                        }
                        
                        .demanda-metadata {
                            grid-template-columns: 1fr;
                        }
                        
                        .demanda-footer {
                            flex-direction: column;
                            gap: 15px;
                            text-align: center;
                        }
                        
                        .demanda-btn {
                            width: 100%;
                            justify-content: center;
                        }
                    }
                    
                    /* EFEITO DE FOCO QUANDO ATRIBU√çDA */
                    .demanda-card.atribuida {
                        opacity: 0.6;
                        transform: scale(0.98);
                        pointer-events: none;
                    }
                    
                    .demanda-card.atribuida .demanda-btn {
                        background: linear-gradient(135deg, #51cf66, #40c057);
                        content: '‚úÖ Atribu√≠da';
                    }
                `;
                
                if (!document.querySelector('#estilo-demandas-reais')) {
                    estiloExtra.id = 'estilo-demandas-reais';
                    document.head.appendChild(estiloExtra);
                }
                
                console.log("‚úÖ API REAL CONECTADA: Demandas reais carregadas com sucesso!");
                
            } catch (erro) {
                console.error("‚ùå ERRO AO CONECTAR COM API REAL:", erro);
                
                // üö® MENSAGEM DE ERRO MELHORADA (SEM DADOS DE EXEMPLO)
                container.innerHTML = `
                    <div style="background: #fff5f5; border: 2px solid #fed7d7; border-radius: 10px; padding: 25px; margin: 20px 0;">
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                            <div style="font-size: 36px; color: #e53e3e;">‚ö†Ô∏è</div>
                            <div>
                                <h3 style="color: #c53030; margin: 0;">Falha na Conex√£o</h3>
                                <p style="margin: 5px 0 0 0; color: #742a2a;">
                                    N√£o foi poss√≠vel conectar com o servidor de demandas
                                </p>
                            </div>
                        </div>
                        
                        <div style="background: white; padding: 15px; border-radius: 6px; margin-top: 15px;">
                            <p><strong>Detalhes do erro:</strong> ${erro.message}</p>
                            <p><strong>O que fazer:</strong></p>
                            <ol style="margin: 10px 0 10px 20px; color: #4a5568;">
                                <li>Verifique se o servidor est√° rodando</li>
                                <li>Confira sua conex√£o com a internet</li>
                                <li>Tente recarregar a p√°gina (F5)</li>
                                <li>Se o problema persistir, contate o suporte</li>
                            </ol>
                        </div>
                        
                        <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #e2e8f0;">
                            <button 
                                onclick="carregarDemandasNaoAtribuidas()" 
                                style="background: #e53e3e; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
                                üîÑ Tentar Novamente
                            </button>
                            
                            <button 
                                onclick="window.location.reload()" 
                                style="background: #718096; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-left: 10px;">
                                üîÉ Recarregar P√°gina
                            </button>
                        </div>
                    </div>
                `;
            }
        }

        // Fun√ß√£o para carregar demandas de exemplo (se API falhar)
        function carregarDemandasExemplo() {
            console.log("üìã Carregando demandas de exemplo...");
            
            const demandasExemplo = [
                {
                    id: 'exemplo1',
                    titulo: 'Corrigir provas do 3¬∫ ano',
                    descricao: 'Provas de matem√°tica que precisam ser corrigidas urgentemente',
                    prioridade: 'alta',
                    dataCriacao: '2024-01-15',
                    atribuidaPara: null
                },
                {
                    id: 'exemplo2', 
                    titulo: 'Preparar material de aula',
                    descricao: 'Material sobre hist√≥ria do Brasil para o 2¬∫ ano',
                    prioridade: 'media',
                    dataCriacao: '2024-01-14',
                    atribuidaPara: null
                },
                {
                    id: 'exemplo3',
                    titulo: 'Organizar biblioteca',
                    descricao: 'Reorganizar os livros por ordem alfab√©tica',
                    prioridade: 'baixa',
                    dataCriacao: '2024-01-13',
                    atribuidaPara: null
                },
                {
                    id: 'exemplo4',
                    titulo: 'Atualizar sistema de notas',
                    descricao: 'Inserir as notas do √∫ltimo bimestre no sistema',
                    prioridade: 'alta',
                    dataCriacao: '2024-01-12',
                    atribuidaPara: null
                }
            ];
            
            const container = document.getElementById('demandas-nao-atribuidas');
            let html = '<div class="lista-demandas">';
            
            demandasExemplo.forEach(demanda => {
                // Cor baseada na prioridade
                let corPrioridade = '#f39c12'; // m√©dia
                if (demanda.prioridade === 'alta') corPrioridade = '#e74c3c';
                if (demanda.prioridade === 'baixa') corPrioridade = '#2ecc71';
                
                html += `
                    <div class="demanda-item" id="demanda-${demanda.id}">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                            <div>
                                <strong style="font-size: 16px;">${demanda.titulo} (Exemplo)</strong>
                                <p style="margin: 5px 0; color: #666;">${demanda.descricao}</p>
                                <div style="display: flex; gap: 10px; margin-top: 10px;">
                                    <span style="background: ${corPrioridade}; color: white; padding: 3px 8px; border-radius: 3px; font-size: 12px;">
                                        ${demanda.prioridade.toUpperCase()}
                                    </span>
                                    <span style="color: #7f8c8d; font-size: 12px;">üìÖ ${new Date(demanda.dataCriacao).toLocaleDateString('pt-BR')}</span>
                                </div>
                            </div>
                            <button 
                                class="btn-atribuir" 
                                data-id="${demanda.id}"
                                data-titulo="${demanda.titulo}"
                                onclick="atribuirDemanda('${demanda.id}', '${demanda.titulo.replace(/'/g, "\\'")}')">
                                Atribuir Demanda
                            </button>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
            
            console.log("‚úÖ Demandas de exemplo carregadas");
        }
        
        // üîß FUN√á√ÉO COMPLETAMENTE CORRIGIDA: Atribuir demanda usando API REAL
        async function atribuirDemanda(demandaId, demandatitulo) {
            console.log(`üéØ ATRIBUINDO DEMANDA REAL: ${demandatitulo} (ID: ${demandaId})`);
            
            // üõ°Ô∏è PASSO 1: Verificar se tem usu√°rio selecionado (CORRIGIDO)
            console.log("üîç Procurando usu√°rio selecionado...");
            
            // M√©todo PRINCIPAL: pela classe
            let usuarioSelecionado = document.querySelector('.usuario-card.selecionado, .usuario-item.selecionado');
            
            // M√©todo ALTERNATIVO: pelo estilo (fallback)
            if (!usuarioSelecionado) {
                console.log("‚ö†Ô∏è  N√£o encontrou por classe, tentando pelo estilo...");
                usuarioSelecionado = document.querySelector('[style*="border-color: #2ecc71"]');
            }
            
            // DEBUG detalhado
            console.log("Elemento encontrado:", usuarioSelecionado);
            
            if (!usuarioSelecionado) {
                console.error("‚ùå NENHUM USU√ÅRIO SELECIONADO ENCONTRADO!");
                
                // Mensagem amig√°vel
                const mensagemDiv = document.createElement('div');
                mensagemDiv.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: #f39c12;
                    color: white;
                    padding: 15px 25px;
                    border-radius: 8px;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                    z-index: 1000;
                    animation: slideIn 0.5s ease;
                    max-width: 400px;
                `;
                
                mensagemDiv.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 24px;">üëÜ</span>
                        <div>
                            <strong>Primeiro selecione um usu√°rio!</strong>
                            <div style="font-size: 14px; margin-top: 5px;">
                                Clique em "Selecionar" em um usu√°rio da lista √† direita.
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(mensagemDiv);
                
                setTimeout(() => {
                    if (mensagemDiv.parentNode) {
                        mensagemDiv.parentNode.removeChild(mensagemDiv);
                    }
                }, 4000);
                
                return;
            }
            
            // üë§ PASSO 2: Pegar dados do usu√°rio selecionado (CORRIGIDO)
            console.log("‚úÖ Usu√°rio selecionado encontrado!");
            
            // Tentar pegar pelo bot√£o dentro do elemento
            const botaoSelecionado = usuarioSelecionado.querySelector('.btn-selecionar, .btn-selecionar-card');
            let usuarioId, usuarioNome;
            
            if (botaoSelecionado) {
                // Se tem bot√£o, pegar dos atributos do bot√£o
                usuarioId = botaoSelecionado.getAttribute('data-id');
                usuarioNome = botaoSelecionado.getAttribute('data-nome');
                console.log(`üìã Dados do BOT√ÉO: ID=${usuarioId}, Nome=${usuarioNome}`);
            } else {
                // Se n√£o tem bot√£o, tentar pegar do pr√≥prio elemento
                usuarioId = usuarioSelecionado.getAttribute('data-id') || 
                            usuarioSelecionado.querySelector('[data-id]')?.getAttribute('data-id');
                usuarioNome = usuarioSelecionado.getAttribute('data-nome') || 
                              usuarioSelecionado.querySelector('[data-nome]')?.getAttribute('data-nome');
                console.log(`üìã Dados do ELEMENTO: ID=${usuarioId}, Nome=${usuarioNome}`);
            }
            
            // VALIDA√á√ÉO FINAL dos dados
            if (!usuarioId || !usuarioNome || usuarioId === 'null' || usuarioNome === 'null') {
                console.error("‚ùå Dados do usu√°rio inv√°lidos!", { usuarioId, usuarioNome });
                alert("Erro: N√£o foi poss√≠vel identificar o usu√°rio selecionado. Tente selecionar novamente.");
                return;
            }
            
            console.log(`üë§ USU√ÅRIO CONFIRMADO: ${usuarioNome} (ID: ${usuarioId})`);
            
            // ‚ùì PASSO 3: Pedir confirma√ß√£o
            const confirmacao = confirm(`ATRIBUIR DEMANDA:\n\n"${demandatitulo}"\n\nPara: ${usuarioNome}\n\nConfirmar?`);
            
            if (!confirmacao) {
                console.log("‚ùå Atribui√ß√£o cancelada pelo usu√°rio");
                return;
            }
            
            // üîÑ PASSO 4: Mostrar estado de carregamento
            const botaoDemanda = document.querySelector(`button[data-id="${demandaId}"]`);
            const textoOriginal = botaoDemanda?.textContent || "Atribuir";
            
            if (botaoDemanda) {
                botaoDemanda.textContent = "üîÑ Atribuindo...";
                botaoDemanda.disabled = true;
                botaoDemanda.style.background = '#95a5a6';
                botaoDemanda.style.opacity = '0.7';
            }
            
            // Mostrar indicador de carregamento
            const loadingDiv = document.createElement('div');
            loadingDiv.id = 'loading-atribuicao';
            loadingDiv.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.7);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 9999;
                flex-direction: column;
            `;
            
            loadingDiv.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 10px; text-align: center; max-width: 400px;">
                    <div style="font-size: 48px; margin-bottom: 20px;">üîÑ</div>
                    <h3 style="color: #2c3e50;">Processando Atribui√ß√£o</h3>
                    <p style="color: #7f8c8d; margin: 15px 0;">
                        "${demandatitulo.substring(0, 50)}${demandatitulo.length > 50 ? '...' : ''}"
                    </p>
                    <p><strong>Para:</strong> ${usuarioNome}</p>
                    <div style="margin-top: 20px; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                        <small>Conectando com o servidor...</small>
                    </div>
                </div>
            `;
            
            document.body.appendChild(loadingDiv);
            
            try {
                // üì° PASSO 5: PREPARAR DADOS PARA API REAL (VERS√ÉO CORRIGIDA)
                console.log("üì° Preparando dados para API real...");
                
                // üìå IMPORTANTE: A API espera TODOS os campos da demanda, n√£o s√≥ a atribui√ß√£o
                // Primeiro, buscar os dados COMPLETOS da demanda
                console.log(`üîç Buscando dados completos da demanda ${demandaId}...`);
                
                const respostaGet = await fetch(`/api/demandas/${demandaId}`);
                
                if (!respostaGet.ok) {
                    throw new Error(`Erro ao buscar demanda: ${respostaGet.status}`);
                }
                
                const dadosDemanda = await respostaGet.json();
                console.log("üì¶ Dados completos da demanda:", dadosDemanda);
                
                if (!dadosDemanda.success || !dadosDemanda.data) {
                    throw new Error("Demanda n√£o encontrada ou dados inv√°lidos");
                }
                
                // Preparar dados para ATUALIZA√á√ÉO (PUT)
                const demandaCompleta = dadosDemanda.data;
                
                const dadosParaAtualizar = {
                    // üîÑ Manter TODOS os campos existentes
                    titulo: demandaCompleta.titulo,
                    descricao: demandaCompleta.descricao,
                    escola: demandaCompleta.escola,
                    departamento: demandaCompleta.departamento,
                    prioridade: demandaCompleta.prioridade || 'M√©dia',
                    status: 'em_andamento', // Muda status quando atribu√≠da
                    
                    // üë§ Adicionar/atualizar respons√°vel
                    responsavel: {
                        id: usuarioId,
                        nome: usuarioNome
                    },
                    
                    // üìÖ Adicionar data de atribui√ß√£o
                    dataAtribuicao: new Date().toISOString(),
                    
                    // üîÑ Atualizar data de modifica√ß√£o
                    atualizadoEm: new Date().toISOString()
                };
                
                console.log("üì§ Dados para enviar (PUT):", dadosParaAtualizar);
                
                // üì° PASSO 6: ENVIAR ATUALIZA√á√ÉO PARA API
                console.log(`üåê Enviando PUT para: /api/demandas/${demandaId}`);
                
                const resposta = await fetch(`/api/demandas/${demandaId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(dadosParaAtualizar)
                });
                
                // üì° PASSO 7: VERIFICAR RESPOSTA
                const respostaTexto = await resposta.text();
                console.log("üì• Resposta bruta:", respostaTexto);
                
                if (!resposta.ok) {
                    throw new Error(`API respondeu com erro ${resposta.status}: ${respostaTexto}`);
                }
                
                const resultado = JSON.parse(respostaTexto);
                console.log("‚úÖ RESPOSTA DA API REAL:", resultado);
                
                if (!resultado.success) {
                    throw new Error(`API n√£o processou a atribui√ß√£o: ${resultado.message}`);
                }
                
                // üéâ PASSO 8: SUCESSO
                console.log("üéâ DEMANDA ATRIBU√çDA COM SUCESSO VIA API REAL!");
                
                // Remover loading
                if (loadingDiv.parentNode) {
                    loadingDiv.parentNode.removeChild(loadingDiv);
                }
                
                // Atualizar bot√£o
                if (botaoDemanda) {
                    botaoDemanda.textContent = "‚úÖ Atribu√≠da!";
                    botaoDemanda.style.background = '#2ecc71';
                    botaoDemanda.style.opacity = '1';
                }
                
                // üóëÔ∏è PASSO 9: Remover demanda da lista
                setTimeout(() => {
                    const demandaItem = document.getElementById(`demanda-${demandaId}`);
                    if (demandaItem) {
                        // Anima√ß√£o
                        demandaItem.style.opacity = '0';
                        demandaItem.style.transform = 'translateX(-50px)';
                        demandaItem.style.transition = 'all 0.5s';
                        
                        setTimeout(() => {
                            if (demandaItem.parentNode) {
                                demandaItem.parentNode.removeChild(demandaItem);
                                console.log(`üóëÔ∏è Demanda removida da lista`);
                                
                                // Atualizar contador
                                atualizarContadorDemandas();
                                
                                // Mostrar mensagem de sucesso
                                mostrarMensagemSucesso(demandatitulo, usuarioNome, resultado.data);
                            }
                        }, 500);
                    }
                }, 1000);
                
            } catch (erro) {
                console.error("‚ùå ERRO AO ATRIBUIR VIA API REAL:", erro);
                
                // Remover loading
                if (loadingDiv.parentNode) {
                    loadingDiv.parentNode.removeChild(loadingDiv);
                }
                
                // Restaurar bot√£o
                if (botaoDemanda) {
                    botaoDemanda.textContent = "‚ùå Erro";
                    botaoDemanda.style.background = '#e74c3c';
                    
                    setTimeout(() => {
                        botaoDemanda.textContent = textoOriginal;
                        botaoDemanda.disabled = false;
                        botaoDemanda.style.background = '';
                        botaoDemanda.style.opacity = '1';
                    }, 2000);
                }
                
                // Mostrar erro
                alert(`ERRO: ${erro.message}\n\nVerifique o console para detalhes.`);
            }
        }
        
        // üîî FUN√á√ÉO ATUALIZADA: Mostrar mensagem de sucesso com dados da API REAL
        function mostrarMensagemSucesso(demandatitulo, usuarioNome, dadosApi = null) {
            console.log("üéä Mostrando mensagem de sucesso com dados da API:", dadosApi);
            
            // Criar elemento de mensagem
            const mensagemDiv = document.createElement('div');
            mensagemDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #2ecc71, #27ae60);
                color: white;
                padding: 20px;
                border-radius: 10px;
                box-shadow: 0 6px 20px rgba(46, 204, 113, 0.3);
                z-index: 1000;
                animation: slideInSuccess 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
                max-width: 450px;
                border-left: 5px solid #27ae60;
            `;
            
            // Conte√∫do baseado nos dados da API
            let conteudoMensagem = '';
            
            if (dadosApi) {
                // üìä SE TEM DADOS DA API: Mostrar informa√ß√µes completas
                const dataAtribuicao = dadosApi.dataAtribuicao ? 
                    new Date(dadosApi.dataAtribuicao).toLocaleString('pt-BR') : 
                    new Date().toLocaleString('pt-BR');
                
                const escola = dadosApi.escola || 'Escola n√£o especificada';
                const prioridade = dadosApi.prioridade || 'M√©dia';
                
                conteudoMensagem = `
                    <div style="display: flex; align-items: flex-start; gap: 15px;">
                        <div style="font-size: 32px; background: white; color: #2ecc71; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                            ‚úÖ
                        </div>
                        <div style="flex: 1;">
                            <strong style="font-size: 16px; display: block; margin-bottom: 8px;">‚úÖ Atribui√ß√£o Confirmada!</strong>
                            
                            <div style="background: rgba(255,255,255,0.15); padding: 12px; border-radius: 6px; margin: 10px 0;">
                                <div style="font-weight: bold; margin-bottom: 5px;">"${demandatitulo}"</div>
                                <div style="font-size: 13px; opacity: 0.9;">üìå Agora √© responsabilidade de:</div>
                                <div style="font-size: 15px; font-weight: bold; margin: 5px 0;">üë§ ${usuarioNome}</div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 12px 0; font-size: 12px;">
                                <div style="background: rgba(255,255,255,0.1); padding: 6px; border-radius: 4px;">
                                    <div>üè´ Escola</div>
                                    <div style="font-weight: bold;">${escola.substring(0, 15)}${escola.length > 15 ? '...' : ''}</div>
                                </div>
                                <div style="background: rgba(255,255,255,0.1); padding: 6px; border-radius: 4px;">
                                    <div>‚ö° Prioridade</div>
                                    <div style="font-weight: bold;">${prioridade}</div>
                                </div>
                            </div>
                            
                            <div style="font-size: 11px; opacity: 0.8; margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.2);">
                                üìÖ Atribu√≠da em: ${dataAtribuicao}
                                ${dadosApi._id ? `<br>üÜî ID: ${dadosApi._id.substring(0, 8)}...` : ''}
                            </div>
                        </div>
                    </div>
                `;
            } else {
                // üì± SE N√ÉO TEM DADOS DA API: Mensagem mais simples
                conteudoMensagem = `
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <span style="font-size: 32px;">‚úÖ</span>
                        <div>
                            <strong style="font-size: 16px;">Demanda atribu√≠da com sucesso!</strong>
                            <div style="font-size: 14px; margin-top: 8px;">
                                <div>"${demandatitulo}"</div>
                                <div style="margin-top: 5px;">‚Üí Agora √© responsabilidade de <strong>${usuarioNome}</strong></div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            mensagemDiv.innerHTML = conteudoMensagem;
            
            // Adicionar anima√ß√£o CSS espec√≠fica
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideInSuccess {
                    from { 
                        transform: translateX(100%) translateY(-20px); 
                        opacity: 0; 
                    }
                    to { 
                        transform: translateX(0) translateY(0); 
                        opacity: 1; 
                    }
                }
                @keyframes slideOutSuccess {
                    from { 
                        transform: translateX(0) translateY(0); 
                        opacity: 1; 
                    }
                    to { 
                        transform: translateX(100%) translateY(-20px); 
                        opacity: 0; 
                    }
                }
            `;
            
            if (!document.querySelector('#animacao-sucesso')) {
                style.id = 'animacao-sucesso';
                document.head.appendChild(style);
            }
            
            // Adicionar ao corpo da p√°gina
            document.body.appendChild(mensagemDiv);
            
            // üéØ Adicionar bot√£o de fechar
            const botaoFechar = document.createElement('button');
            botaoFechar.textContent = '‚úï';
            botaoFechar.style.cssText = `
                position: absolute;
                top: 10px;
                right: 10px;
                background: rgba(255,255,255,0.2);
                color: white;
                border: none;
                width: 24px;
                height: 24px;
                border-radius: 50%;
                cursor: pointer;
                font-size: 12px;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: background 0.2s;
            `;
            
            botaoFechar.onclick = function() {
                fecharMensagem(mensagemDiv);
            };
            
            mensagemDiv.appendChild(botaoFechar);
            
            // Efeito hover no bot√£o de fechar
            botaoFechar.onmouseover = function() {
                this.style.background = 'rgba(255,255,255,0.3)';
            };
            
            botaoFechar.onmouseout = function() {
                this.style.background = 'rgba(255,255,255,0.2)';
            };
            
            // Fun√ß√£o para fechar a mensagem
            function fecharMensagem(elemento) {
                elemento.style.animation = 'slideOutSuccess 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55)';
                setTimeout(() => {
                    if (elemento.parentNode) {
                        elemento.parentNode.removeChild(elemento);
                    }
                }, 500);
            }
            
            // üìä Adicionar bot√£o para ver mais detalhes (se tiver dados da API)
            if (dadosApi && dadosApi._id) {
                const botaoDetalhes = document.createElement('button');
                botaoDetalhes.textContent = 'üìã Ver Detalhes';
                botaoDetalhes.style.cssText = `
                    background: rgba(255,255,255,0.9);
                    color: #27ae60;
                    border: none;
                    padding: 8px 15px;
                    border-radius: 5px;
                    cursor: pointer;
                    font-size: 12px;
                    font-weight: bold;
                    margin-top: 15px;
                    width: 100%;
                    transition: all 0.2s;
                `;
                
                botaoDetalhes.onmouseover = function() {
                    this.style.background = 'white';
                    this.style.transform = 'translateY(-2px)';
                };
                
                botaoDetalhes.onmouseout = function() {
                    this.style.background = 'rgba(255,255,255,0.9)';
                    this.style.transform = 'translateY(0)';
                };
                
                botaoDetalhes.onclick = function() {
                    console.log("üìã Mostrando detalhes da demanda:", dadosApi);
                    alert(`Detalhes da demanda:\n\nT√≠tulo: ${dadosApi.titulo || demandatitulo}\nRespons√°vel: ${dadosApi.responsavel?.nome || usuarioNome}\nEscola: ${dadosApi.escola || 'N√£o especificada'}\nStatus: ${dadosApi.status || 'em_andamento'}\nID: ${dadosApi._id}`);
                };
                
                // Encontrar o container para adicionar o bot√£o
                const containerBotoes = mensagemDiv.querySelector('div > div');
                if (containerBotoes) {
                    containerBotoes.appendChild(botaoDetalhes);
                }
            }
            
            // ‚è∞ Remover automaticamente ap√≥s 8 segundos
            setTimeout(() => {
                if (mensagemDiv.parentNode) {
                    fecharMensagem(mensagemDiv);
                }
            }, 8000);
            
            // üîä Efeito sonoro simulado (apenas log)
            console.log("üîä (Som simulado): Sucesso! Demanda atribu√≠da!");
        }
        
        // üîÑ Fun√ß√£o para atualizar contador de demandas
        function atualizarContadorDemandas() {
            const demandasRestantes = document.querySelectorAll('.demanda-item').length;
            console.log(`üìä Demandas restantes: ${demandasRestantes}`);
            
            // Pode adicionar um contador visual aqui se quiser
            if (demandasRestantes === 0) {
                const container = document.getElementById('demandas-nao-atribuidas');
                if (container && !container.innerHTML.includes('üéâ')) {
                    container.innerHTML = '<p style="text-align: center; padding: 40px; color: #27ae60; font-size: 18px;">üéâ Todas as demandas foram atribu√≠das! üéâ</p>';
                }
            }
        }
        
        // üëÜ FUN√á√ÉO ATUALIZADA: Selecionar usu√°rio (VERS√ÉO COMPAT√çVEL COM CARDS)
        function selecionarUsuario(botao) {
            console.log("üëÜ Selecionar usu√°rio chamado (vers√£o compat√≠vel com cards)!");
            
            // 1. Pegar os dados do bot√£o CLICADO
            const usuarioId = botao.getAttribute('data-id');
            const usuarioNome = botao.getAttribute('data-nome');
            
            console.log(`üìã Dados do bot√£o: ID=${usuarioId}, Nome=${usuarioNome}`);
            
            if (!usuarioId || usuarioId === 'null' || usuarioId === 'undefined') {
                console.error("‚ùå ERRO: Bot√£o n√£o tem data-id correto!");
                return;
            }
            
            // 2. Tentar encontrar o card pai
            let usuarioCard = botao.closest('.usuario-card');
            
            if (!usuarioCard) {
                console.log("‚ö†Ô∏è N√£o encontrou .usuario-card, tentando .usuario-item...");
                usuarioCard = botao.closest('.usuario-item');
            }
            
            if (!usuarioCard) {
                console.error("‚ùå ERRO: N√£o encontrou elemento pai do bot√£o!");
                console.log("Bot√£o clicado:", botao);
                return;
            }
            
            // 3. Remover sele√ß√£o anterior de CARDS
            document.querySelectorAll('.usuario-card, .usuario-item').forEach(item => {
                item.classList.remove('selecionado');
                item.style.borderColor = '';
                item.style.background = '';
                item.style.transform = '';
                
                // Restaurar bot√µes dentro
                const btn = item.querySelector('.btn-selecionar, .btn-selecionar-card');
                if (btn) {
                    btn.textContent = btn.classList.contains('btn-selecionar-card') 
                        ? 'Selecionar' 
                        : 'Selecionar';
                    btn.disabled = false;
                    btn.style.background = '';
                    
                    // Restaurar √≠cone se for card
                    if (btn.classList.contains('btn-selecionar-card')) {
                        btn.innerHTML = '<span class="btn-icon">üëÜ</span> Selecionar';
                    }
                }
            });
            
            // 4. Adicionar sele√ß√£o
            usuarioCard.classList.add('selecionado');
            
            // 5. Estilizar de acordo com o tipo de elemento
            if (usuarioCard.classList.contains('usuario-card')) {
                // √â um card novo
                usuarioCard.style.borderColor = '#2ecc71';
                usuarioCard.style.background = 'linear-gradient(135deg, #f0f9ff, #e6f7f0)';
                usuarioCard.style.transform = 'translateY(-3px)';
                
                // Atualizar bot√£o do card
                const btnCard = usuarioCard.querySelector('.btn-selecionar-card');
                if (btnCard) {
                    btnCard.innerHTML = '<span class="btn-icon">‚úÖ</span> Selecionado';
                    btnCard.style.background = 'linear-gradient(135deg, #2ecc71, #27ae60)';
                    btnCard.disabled = true;
                }
            } else {
                // √â um item antigo (backward compatibility)
                usuarioCard.style.borderColor = '#2ecc71';
                usuarioCard.style.background = '#d5f4e6';
                usuarioCard.style.transform = 'scale(1.02)';
                
                botao.textContent = '‚úÖ Selecionado';
                botao.style.background = '#2ecc71';
                botao.disabled = true;
            }
            
            console.log(`üéØ Usu√°rio selecionado: ${usuarioNome} (ID: ${usuarioId})`);
            
            // 6. Mostrar mensagem
            mostrarMensagemUsuarioSelecionado(usuarioNome);
            
            // 7. Guardar em vari√°vel global para debug
            window.usuarioSelecionadoDebug = {
                id: usuarioId,
                nome: usuarioNome,
                elemento: usuarioCard
            };
            
            console.log("üìå Debug salvo:", window.usuarioSelecionadoDebug);
        }
        
        // üí¨ Fun√ß√£o para mostrar qual usu√°rio foi selecionado
        function mostrarMensagemUsuarioSelecionado(nomeUsuario) {
            // Remover mensagem anterior se existir
            const msgAnterior = document.getElementById('msg-usuario-selecionado');
            if (msgAnterior) msgAnterior.remove();
            
            // Criar nova mensagem
            const mensagemDiv = document.createElement('div');
            mensagemDiv.id = 'msg-usuario-selecionado';
            mensagemDiv.style.cssText = `
                background: #3498db;
                color: white;
                padding: 10px 15px;
                border-radius: 5px;
                margin: 10px 0;
                text-align: center;
                animation: fadeIn 0.5s ease;
            `;
            
            mensagemDiv.innerHTML = `
                <strong>üë§ Usu√°rio selecionado:</strong> ${nomeUsuario}<br>
                <small>Agora clique em "Atribuir Demanda" em qualquer demanda para atribuir</small>
            `;
            
            // Adicionar ao container de usu√°rios
            const container = document.getElementById('usuarios-disponiveis');
            container.insertBefore(mensagemDiv, container.firstChild);
            
            // Adicionar anima√ß√£o CSS se n√£o existir
            if (!document.querySelector('#animacoes-usuario')) {
                const style = document.createElement('style');
                style.id = 'animacoes-usuario';
                style.textContent = `
                    @keyframes fadeIn {
                        from { opacity: 0; transform: translateY(-10px); }
                        to { opacity: 1; transform: translateY(0); }
                    }
                `;
                document.head.appendChild(style);
            }
        }

        // üîÑ Fun√ß√£o para carregar minhas demandas (VERS√ÉO ATUALIZADA)
        async function carregarMinhasDemandas() {
            console.log("üìã Carregando minhas demandas...");
            
            try {
                // Esta fun√ß√£o ser√° implementada depois que tivermos login
                // Por enquanto, mostrar mensagem
                const container = document.getElementById('minhas-demandas');
                container.innerHTML = `
                    <div style="text-align: center; padding: 30px; color: #7f8c8d;">
                        <div style="font-size: 48px; margin-bottom: 20px;">üë§</div>
                        <h3>Suas Demandas Atribu√≠das</h3>
                        <p>Esta funcionalidade ser√° ativada ap√≥s o sistema de login.</p>
                        <p><small>Voc√™ ver√° aqui as demandas que foram atribu√≠das para voc√™.</small></p>
                        <div style="margin-top: 20px; padding: 15px; background: #ecf0f1; border-radius: 5px;">
                            <strong>Funcionalidades futuras:</strong><br>
                            ‚Ä¢ Aceitar/rejeitar demandas<br>
                            ‚Ä¢ Marcar como conclu√≠do<br>
                            ‚Ä¢ Ver hist√≥rico
                        </div>
                    </div>
                `;
                
            } catch (erro) {
                console.error("‚ùå Erro ao carregar minhas demandas:", erro);
                document.getElementById('minhas-demandas').innerHTML = `
                    <p style="color: #e74c3c;">Erro ao carregar suas demandas: ${erro.message}</p>
                `;
            }
        }
        
        // üéØ FUN√á√ÉO PARA SELECIONAR USU√ÅRIO PELO CARD (CLIQUE NO CARD INTEIRO)
        function selecionarUsuarioCard(cardElement) {
            console.log("üÉè Card de usu√°rio clicado!");
            
            // Encontrar o bot√£o dentro do card
            const botao = cardElement.querySelector('.btn-selecionar-card');
            
            if (botao) {
                // Usar a fun√ß√£o principal para selecionar
                selecionarUsuario(botao);
            } else {
                console.error("‚ùå ERRO: N√£o encontrou bot√£o dentro do card!");
            }
        }

        // Carregar dados quando a p√°gina abrir
        window.addEventListener('DOMContentLoaded', carregarDados);
        
        // üéØ Event Listeners - Fazem os bot√µes funcionarem
        document.addEventListener('click', function(event) {
            // Quando clicar em um bot√£o "Selecionar"
            if (event.target.classList.contains('btn-selecionar')) {
                console.log("üëÜ Bot√£o Selecionar clicado!");
                selecionarUsuario(event.target);
            }
            
            // Quando clicar em um bot√£o "Atribuir Demanda" (vers√£o alternativa)
            if (event.target.classList.contains('btn-atribuir') && event.target.hasAttribute('data-id')) {
                const demandaId = event.target.getAttribute('data-id');
                const demandatitulo = event.target.getAttribute('data-titulo');
                console.log(`üéØ Atribuir Demanda clicado: ${demandatitulo}`);
                atribuirDemanda(demandaId, demandatitulo);
            }
        });
        
        // üì¢ Adicionar mensagem de instru√ß√£o inicial
        window.addEventListener('load', function() {
            setTimeout(() => {
                if (!document.getElementById('msg-usuario-selecionado')) {
                    const instrucaoDiv = document.createElement('div');
                    instrucaoDiv.style.cssText = `
                        background: #f39c12;
                        color: white;
                        padding: 12px;
                        border-radius: 5px;
                        margin: 15px 0;
                        text-align: center;
                        animation: pulse 2s infinite;
                    `;
                    
                    instrucaoDiv.innerHTML = `
                        <strong>üìã COMO USAR:</strong><br>
                        1. üëÜ Selecione um usu√°rio clicando em "Selecionar"<br>
                        2. üéØ Escolha uma demanda e clique em "Atribuir Demanda"<br>
                        3. ‚úÖ Confirme a atribui√ß√£o e veja o resultado!
                    `;
                    
                    // Adicionar anima√ß√£o de pulsar
                    const style = document.createElement('style');
                    style.textContent = `
                        @keyframes pulse {
                            0% { opacity: 1; }
                            50% { opacity: 0.8; }
                            100% { opacity: 1; }
                        }
                    `;
                    document.head.appendChild(style);
                    
                    // Adicionar no topo da p√°gina
                    const container = document.querySelector('.container');
                    if (container) {
                        container.insertBefore(instrucaoDiv, container.firstChild);
                        
                        // Remover ap√≥s 15 segundos
                        setTimeout(() => {
                            if (instrucaoDiv.parentNode) {
                                instrucaoDiv.style.transition = 'opacity 1s';
                                instrucaoDiv.style.opacity = '0';
                                setTimeout(() => {
                                    if (instrucaoDiv.parentNode) {
                                        instrucaoDiv.parentNode.removeChild(instrucaoDiv);
                                    }
                                }, 1000);
                            }
                        }, 15000);
                    }
                }
            }, 2000);
        });
        
        console.log("üéâ Sistema de atribui√ß√£o carregado e pronto para uso!");
        console.log("üëâ Selecione um usu√°rio e clique em 'Atribuir Demanda' para testar!");
        // ============================================
// üçî CORRE√á√ÉO DO BOT√ÉO SANDU√çCHE
// ============================================

// 1. Aguardar a p√°gina carregar
document.addEventListener('DOMContentLoaded', function() {
    console.log("üîß Iniciando corre√ß√£o do bot√£o sandu√≠che...");
    
    // Pequeno delay para garantir que tudo carregou
    setTimeout(corrigirBotaoSanduiche, 500);
});

// 2. Fun√ß√£o para corrigir o bot√£o sandu√≠che
function corrigirBotaoSanduiche() {
    console.log("üîç Procurando bot√£o sandu√≠che...");
    
    // Encontrar o bot√£o
    const botaoSanduiche = document.querySelector('.navbar-toggler');
    
    if (!botaoSanduiche) {
        console.error("‚ùå ERRO: Bot√£o sandu√≠che n√£o encontrado!");
        return;
    }
    
    console.log("‚úÖ Bot√£o sandu√≠che encontrado!");
    
    // 3. REMOVER todos os event listeners antigos (limpeza)
    const novoBotao = botaoSanduiche.cloneNode(true);
    botaoSanduiche.parentNode.replaceChild(novoBotao, botaoSanduiche);
    
    // Agora usar o NOVO bot√£o
    const botaoCorrigido = document.querySelector('.navbar-toggler');
    
    // 4. Adicionar clique MANUAL se Bootstrap n√£o funcionar
    botaoCorrigido.addEventListener('click', function(event) {
        console.log("üçî Bot√£o sandu√≠che clicado (manualmente)!");
        
        // Encontrar o menu que deve abrir
        const menuId = this.getAttribute('data-bs-target') || '#navbarSupportedContent';
        const menu = document.querySelector(menuId);
        
        if (menu) {
            // Alternar entre mostrar/esconder
            if (menu.classList.contains('show')) {
                // Se j√° est√° aberto, FECHAR
                menu.classList.remove('show');
                console.log("üì¥ Fechando menu...");
            } else {
                // Se est√° fechado, ABRIR
                menu.classList.add('show');
                console.log("üì± Abrindo menu...");
            }
            
            // Tamb√©m alternar a classe do bot√£o (para anima√ß√£o)
            this.classList.toggle('collapsed');
        } else {
            console.error("‚ùå Menu n√£o encontrado:", menuId);
        }
    });
    
    console.log("‚úÖ Bot√£o sandu√≠che corrigido e pronto para uso!");
}

// 5. CSS para garantir que funcione
const cssCorrecao = `
    /* Garantir que o menu seja vis√≠vel quando aberto */
    .navbar-collapse.show {
        display: block !important;
    }
    
    /* Bot√£o sandu√≠che mais responsivo */
    .navbar-toggler {
        cursor: pointer;
        border: 2px solid rgba(255, 255, 255, 0.3);
        padding: 8px 10px;
    }
    
    .navbar-toggler:hover {
        background: rgba(255, 255, 255, 0.1);
    }
    
    `;

// Adicionar o CSS corre√ß√£o
if (!document.querySelector('#correcao-sanduiche')) {
    const estilo = document.createElement('style');
    estilo.id = 'correcao-sanduiche';
    estilo.textContent = cssCorrecao;
    document.head.appendChild(estilo);
    console.log("üé® CSS de corre√ß√£o adicionado!");
}

console.log("üìã Sistema de corre√ß√£o do bot√£o sandu√≠che carregado!");
    </script>
</body>
</html>