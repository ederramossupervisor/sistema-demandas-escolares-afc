<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <%- include('partials/head', {title: title}) %>
    <style>
        .dashboard-card { 
            transition: transform 0.3s; 
            border-radius: 8px; 
            border: 1px solid #e9ecef;
            margin-bottom: 15px;
        }
        .dashboard-card:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .card-icon { font-size: 1.5rem; }
        .task-item { 
            border-left: 3px solid #007bff; 
            padding: 8px 10px;
            margin: 3px 0;
            font-size: 0.9rem;
        }
    </style>
    <!-- Chart.js para gr√°ficos -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- CSS adicional para gr√°ficos -->
<style>
    /* Estilos para gr√°ficos */
    .chart-container {
        position: relative;
        height: 300px;
        width: 100%;
        margin-bottom: 20px;
    }
    
    .chart-card {
        transition: all 0.3s ease;
        border-radius: 12px;
        overflow: hidden;
    }
    
    .chart-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    }
    
    /* Filtros para gr√°ficos */
    .chart-filters {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 20px;
    }
    
    /* Cards de estat√≠sticas melhorados */
    .stats-card {
        border-left: 4px solid;
        transition: all 0.3s;
    }
    
    .stats-card:hover {
        transform: translateY(-3px);
    }
    
    /* Cores para diferentes tipos de dados */
    .stats-primary { border-left-color: #4dabf7; }
    .stats-success { border-left-color: #40c057; }
    .stats-warning { border-left-color: #ff922b; }
    .stats-danger { border-left-color: #ff6b6b; }
    .stats-info { border-left-color: #339af0; }
    .stats-purple { border-left-color: #9c36b5; }
</style>
</head>
<body>
    <!-- Navbar -->
    <%- include('partials/navbar', {user: user, currentPage: 'dashboard'}) %>
    
    <!-- CONTAINER PRINCIPAL COM SIDEBAR + DASHBOARD NA MESMA LINHA -->
    <div class="container-fluid mt-3">
        <div class="row">
            
            <!-- COLUNA 1: SIDEBAR UNIFICADA (3 de 12 colunas) -->
            <div class="col-md-3 d-none d-md-block">
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-body p-3">
                        <%- include('partials/sidebar', { 
                            currentPage: 'dashboard', 
                            user: user,
                            escolas: escolas || []
                        }); %>
                    </div>
                </div>
            </div>
            
            <!-- COLUNA 2: DASHBOARD (10 de 12 colunas) -->
            <div class="col-md-9">
                
                <!-- Cabe√ßalho mais compacto -->
                <div class="row mb-3">
                    <div class="col-12">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h4 class="mb-1">
                                    <i class="fas fa-tachometer-alt me-2"></i>Dashboard
                                </h4>
                                <p class="text-muted mb-0" style="font-size: 0.9rem;">
                                    Bem-vindo, <strong><%= user.nome %></strong> 
                                    (<%= user.tipo.charAt(0).toUpperCase() + user.tipo.slice(1) %>)
                                </p>
                            </div>
                        </div>
                        <hr class="mt-2">
                    </div>
                </div>

                <!-- Cards de Estat√≠sticas - REDUZIDO PARA 2 POR LINHA -->
                <div class="row mb-3">
                    <% if (cards && cards.length > 0) { %>
                    <% cards.forEach(function(card) { %>
                    <div class="col-xl-6 col-lg-6 col-md-6 mb-3">
                        <div class="card dashboard-card h-100">
                            <div class="card-body py-2">
                                <div class="d-flex align-items-center">
                                    <div class="me-3">
                                        <i class="<%= card.icone %> card-icon text-<%= card.cor %>"></i>
                                    </div>
                                    <div>
                                        <h6 class="text-muted mb-0" style="font-size: 0.85rem;"><%= card.titulo %></h6>
                                        <h4 class="mb-0"><%= card.valor %></h4>
                                        <% if (card.descricao) { %>
                                        <small class="text-muted" style="font-size: 0.75rem;"><%= card.descricao %></small>
                                        <% } %>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <% }); %>
                    <% } %>
                </div>
                <!-- ==================== -->
                <!-- SE√á√ÉO DE GR√ÅFICOS INTERATIVOS -->
                <!-- ==================== -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card chart-card">
                            <div class="card-header">
                                <h6 class="mb-0">
                                    <i class="fas fa-chart-bar me-2"></i>Estat√≠sticas de Demandas
                                </h6>
                                <small class="text-muted">Vis√£o geral das demandas por status e prioridade</small>
                            </div>
                            <div class="card-body">
                                <!-- Filtros para gr√°ficos -->
                                <div class="chart-filters mb-4">
                                    <div class="row g-2">
                                        <div class="col-md-3 col-6">
                                            <label class="form-label small fw-bold">Per√≠odo</label>
                                            <select class="form-select form-select-sm" id="filterPeriod">
                                                <option value="week">√öltima Semana</option>
                                                <option value="month" selected>√öltimo M√™s</option>
                                                <option value="quarter">√öltimo Trimestre</option>
                                                <option value="year">√öltimo Ano</option>
                                            </select>
                                        </div>
                                        <div class="col-md-3 col-6">
                                            <label class="form-label small fw-bold">Escola</label>
                                            <select class="form-select form-select-sm" id="filterSchool">
                                                <option value="all" selected>Todas as Escolas</option>
                                                <% if (escolas && escolas.length > 0) { %>
                                                    <% escolas.forEach(function(escola) { %>
                                                        <option value="<%= escola %>"><%= escola.length > 25 ? escola.substring(0, 25) + '...' : escola %></option>
                                                    <% }); %>
                                                <% } %>
                                            </select>
                                        </div>
                                        <div class="col-md-3 col-6">
                                            <label class="form-label small fw-bold">Departamento</label>
                                            <select class="form-select form-select-sm" id="filterDepartment">
                                                <option value="all" selected>Todos Departamentos</option>
                                                <option value="Pedagogico">Pedag√≥gico</option>
                                                <option value="Administrativo">Administrativo</option>
                                                <option value="Manutencao">Manuten√ß√£o</option>
                                                <option value="Secretaria">Secretaria</option>
                                            </select>
                                        </div>
                                        <div class="col-md-3 col-6">
                                            <label class="form-label small fw-bold">Tipo de Gr√°fico</label>
                                            <select class="form-select form-select-sm" id="chartType">
                                                <option value="bar" selected>Barras</option>
                                                <option value="line">Linhas</option>
                                                <option value="pie">Pizza</option>
                                                <option value="doughnut">Rosca</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <!-- Container para os gr√°ficos -->
                                <div class="row">
                                    <!-- Gr√°fico 1: Demandas por Status -->
                                    <div class="col-lg-6 mb-4">
                                        <div class="chart-container">
                                            <canvas id="statusChart"></canvas>
                                        </div>
                                        <div class="text-center mt-2">
                                            <small class="text-muted">
                                                <i class="fas fa-info-circle me-1"></i>
                                                Distribui√ß√£o de demandas por status
                                            </small>
                                        </div>
                                    </div>

                                    <!-- Gr√°fico 2: Demandas por Prioridade -->
                                    <div class="col-lg-6 mb-4">
                                        <div class="chart-container">
                                            <canvas id="priorityChart"></canvas>
                                        </div>
                                        <div class="text-center mt-2">
                                            <small class="text-muted">
                                                <i class="fas fa-exclamation-triangle me-1"></i>
                                                Demandas por n√≠vel de prioridade
                                            </small>
                                        </div>
                                    </div>

                                    <!-- Gr√°fico 3: Evolu√ß√£o Temporal -->
                                    <div class="col-lg-12">
                                        <div class="chart-container" style="height: 250px;">
                                            <canvas id="timelineChart"></canvas>
                                        </div>
                                        <div class="text-center mt-2">
                                            <small class="text-muted">
                                                <i class="fas fa-chart-line me-1"></i>
                                                Evolu√ß√£o das demandas ao longo do tempo
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Se√ß√£o de Tarefas - MAIS COMPACTA -->
                <% if (minhasTarefas && minhasTarefas.length > 0) { %>
                <div class="row mb-3">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header py-2">
                                <h6 class="mb-0">
                                    <i class="fas fa-tasks me-2"></i>Minhas Tarefas
                                    <span class="badge bg-primary float-end" style="font-size: 0.7rem;">
                                        <%= minhasTarefas.length %>
                                    </span>
                                </h6>
                            </div>
                            <div class="card-body p-2">
                                <div class="list-group">
                                    <% minhasTarefas.forEach(function(tarefa, index) { 
                                        if (index < 3) { // Mostrar apenas 3 tarefas
                                    %>
                                    <a href="/demandas?id=<%= tarefa._id %>" 
                                       class="list-group-item list-group-item-action task-item py-1">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div style="max-width: 80%;">
                                                <strong style="font-size: 0.85rem;">
                                                    <%= tarefa.titulo.length > 40 ? tarefa.titulo.substring(0, 40) + '...' : tarefa.titulo %>
                                                </strong>
                                                <br>
                                                <small class="text-muted" style="font-size: 0.75rem;">
                                                    <i class="fas fa-school me-1"></i>
                                                    <%= tarefa.escola.length > 20 ? tarefa.escola.substring(0, 20) + '...' : tarefa.escola %>
                                                    ‚Ä¢ 
                                                    <i class="far fa-calendar me-1"></i>
                                                    <%= new Date(tarefa.prazo).toLocaleDateString('pt-BR') %>
                                                </small>
                                            </div>
                                            <div>
                                                <span class="badge bg-<%= tarefa.status === 'pendente' ? 'warning' : 'primary' %>" 
                                                      style="font-size: 0.7rem;">
                                                    <%= tarefa.status === 'pendente' ? 'Pendente' : tarefa.status %>
                                                </span>
                                            </div>
                                        </div>
                                    </a>
                                    <% } }); %>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <% } %>

                <!-- A√ß√µes R√°pidas - COMPACTAS -->
                <% if (quickActions && quickActions.length > 0) { %>
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header py-2">
                                <h6 class="mb-0"><i class="fas fa-bolt me-2"></i>A√ß√µes R√°pidas</h6>
                            </div>
                            <div class="card-body p-2">
                                <div class="d-flex flex-wrap">
                                    <% quickActions.forEach(function(acao) { %>
                                    <a href="<%= acao.url %>" 
                                       class="btn btn-<%= acao.cor %> btn-sm m-1" 
                                       style="font-size: 0.8rem; padding: 5px 10px;">
                                        <i class="<%= acao.icone %> me-1"></i>
                                        <%= acao.texto %>
                                    </a>
                                    <% }); %>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <% } %>
                
            </div> <!-- Fecha col-md-10 (dashboard) -->
            
        </div> <!-- Fecha row -->
    </div> <!-- Fecha container-fluid principal -->

    <!-- Footer -->
    <%- include('partials/footer', {totalDemandas: totalDemandas, anoAtual: anoAtual}) %>

    <!-- Scripts -->
    <%- include('partials/scripts') %>
<!-- Notifica√ß√µes do Dashboard -->
<script>
/* ============================================
   üìä NOTIFICA√á√ïES INTELIGENTES DO DASHBOARD
   ============================================ */

// Aguardar a p√°gina carregar completamente
document.addEventListener('DOMContentLoaded', function() {
    console.log('üöÄ Dashboard carregado - Iniciando notifica√ß√µes...');
    
    // Pequeno delay para garantir que tudo carregou
    setTimeout(() => {
        iniciarNotificacoesDashboard();
    }, 1000);
});

// Fun√ß√£o principal de notifica√ß√µes do dashboard
function iniciarNotificacoesDashboard() {
    console.log('üîî Iniciando sistema de notifica√ß√µes do dashboard...');
    
    // 1Ô∏è‚É£ NOTIFICA√á√ÉO DE BOAS-VINDAS PERSONALIZADA
    const nomeUsuario = '<%= user.nome %>';
    const tipoUsuario = '<%= user.tipo %>';
    const saudacoes = ['Ol√°', 'Bem-vindo(a)', 'Oi', 'Ol√° novamente'];
    const saudacao = saudacoes[Math.floor(Math.random() * saudacoes.length)];
    
    setTimeout(() => {
        if (typeof showSuccess === 'function') {
            showSuccess(
                `${saudacao}, ${nomeUsuario.split(' ')[0]}! üëã`,
                `Seu dashboard est√° pronto. Voc√™ est√° logado como ${tipoUsuario}.`,
                4000
            );
        }
    }, 800);
    
    // 2Ô∏è‚É£ NOTIFICA√á√ÉO DE TAREFAS PENDENTES
    setTimeout(() => {
        const tarefasPendentes = document.querySelectorAll('.badge.bg-warning').length;
        
        if (tarefasPendentes > 0) {
            if (typeof showWarning === 'function') {
                showWarning(
                    'üìã Tarefas Pendentes',
                    `Voc√™ tem ${tarefasPendentes} tarefa(s) pendente(s) que precisam de aten√ß√£o.`,
                    5000
                );
            }
        } else {
            if (typeof showInfo === 'function') {
                showInfo(
                    '‚úÖ Tudo em Dia!',
                    'Parab√©ns! N√£o h√° tarefas pendentes no momento.',
                    3000
                );
            }
        }
    }, 2500);
    
    // 3Ô∏è‚É£ NOTIFICA√á√ÉO DE DEMANDAS URGENTES (se houver)
    setTimeout(() => {
        // Verificar cards de estat√≠sticas
        const cards = document.querySelectorAll('.dashboard-card');
        let demandaUrgente = false;
        
        cards.forEach(card => {
            const texto = card.textContent.toLowerCase();
            if (texto.includes('urgente') || texto.includes('alta') || texto.includes('prioridade')) {
                const valor = card.querySelector('h4');
                if (valor && parseInt(valor.textContent) > 0) {
                    demandaUrgente = true;
                }
            }
        });
        
        if (demandaUrgente && typeof showError === 'function') {
            showError(
                'üö® Aten√ß√£o Urgente!',
                'H√° demandas de alta prioridade que precisam de aten√ß√£o imediata.',
                6000
            );
        }
    }, 4000);
    
    // 4Ô∏è‚É£ NOTIFICA√á√ÉO BASEADA NO HOR√ÅRIO DO DIA
    setTimeout(() => {
        const hora = new Date().getHours();
        let periodo = '';
        
        if (hora < 12) periodo = 'Bom dia';
        else if (hora < 18) periodo = 'Boa tarde';
        else periodo = 'Boa noite';
        
        if (typeof showInfo === 'function') {
            showInfo(
                `${periodo}! ‚òÄÔ∏è`,
                `Aproveite para revisar suas demandas e manter tudo organizado.`,
                3000
            );
        }
    }, 5500);
    
    // 5Ô∏è‚É£ NOTIFICA√á√ÉO DE ATUALIZA√á√ïES (simulada)
    setTimeout(() => {
        // Verificar se √© a primeira visita do dia
        const hoje = new Date().toDateString();
        const ultimaVisita = localStorage.getItem('dashboard_ultima_visita');
        
        if (ultimaVisita !== hoje) {
            if (typeof showInfo === 'function') {
                showInfo(
                    'üîÑ Atualiza√ß√µes do Dia',
                    'Novas demandas podem ter sido adicionadas desde sua √∫ltima visita.',
                    4000
                );
            }
            // Salvar visita de hoje
            localStorage.setItem('dashboard_ultima_visita', hoje);
        }
    }, 7000);
}

// 6Ô∏è‚É£ NOTIFICA√á√ÉO AO REALIZAR A√á√ïES R√ÅPIDAS
function configurarNotificacoesAcoesRapidas() {
    const botoesAcoes = document.querySelectorAll('.btn[href*="/demandas"], .btn[href*="/atribuir"], .btn[href*="/cadastro"]');
    
    botoesAcoes.forEach(botao => {
        botao.addEventListener('click', function(e) {
            const textoBotao = this.textContent.trim();
            const iconeBotao = this.querySelector('i')?.className || 'fas fa-bolt';
            
            // Notifica√ß√£o antes de redirecionar
            setTimeout(() => {
                if (typeof showInfo === 'function') {
                    showInfo(
                        'üîÄ Redirecionando...',
                        `Abrindo ${textoBotao.toLowerCase()}.`,
                        2000
                    );
                }
            }, 100);
        });
    });
}

// 7Ô∏è‚É£ NOTIFICA√á√ÉO AO VISUALIZAR TAREFAS
function configurarNotificacoesTarefas() {
    const linksTarefas = document.querySelectorAll('.task-item[href*="/demandas"]');
    
    linksTarefas.forEach(link => {
        link.addEventListener('click', function(e) {
            const tituloTarefa = this.querySelector('strong')?.textContent || 'Tarefa';
            
            setTimeout(() => {
                if (typeof showInfo === 'function') {
                    showInfo(
                        'üìñ Abrindo Detalhes',
                        `Carregando detalhes da demanda: ${tituloTarefa.substring(0, 30)}...`,
                        2000
                    );
                }
            }, 100);
        });
    });
}

// 8Ô∏è‚É£ SISTEMA DE NOTIFICA√á√ïES AUTOM√ÅTICAS (simula√ß√£o)
function iniciarNotificacoesAutomaticas() {
    // Notifica√ß√£o a cada 5 minutos (300000ms) - apenas para demonstra√ß√£o
    // Em produ√ß√£o, isso seria controlado por WebSockets ou polling
    
    console.log('‚è∞ Sistema de notifica√ß√µes autom√°ticas iniciado');
    
    // Exemplo: Notifica√ß√£o de lembrete ap√≥s 2 minutos
    setTimeout(() => {
        if (typeof showInfo === 'function') {
            showInfo(
                '‚è∞ Lembrete',
                'N√£o se esque√ßa de atualizar o status das demandas em andamento.',
                4000
            );
        }
    }, 120000); // 2 minutos
}

// 9Ô∏è‚É£ CONFIGURAR TODOS OS EVENTOS
function configurarTodosEventos() {
    configurarNotificacoesAcoesRapidas();
    configurarNotificacoesTarefas();
    iniciarNotificacoesAutomaticas();
    
    // Evento para quando o usu√°rio volta para o dashboard
    window.addEventListener('focus', function() {
        if (document.visibilityState === 'visible') {
            setTimeout(() => {
                if (typeof showInfo === 'function') {
                    showInfo(
                        'üëã Voc√™ est√° de volta!',
                        'Bem-vindo(a) novamente ao dashboard.',
                        2000
                    );
                }
            }, 500);
        }
    });
}

// üîü INICIALIZAR TUDO
setTimeout(() => {
    configurarTodosEventos();
    console.log('‚úÖ Sistema de notifica√ß√µes do dashboard configurado!');
}, 1500);

// Fun√ß√£o para testar todas as notifica√ß√µes (apenas desenvolvimento)
window.testarNotificacoesDashboard = function() {
    if (typeof showSuccess === 'function') {
        showSuccess('‚úÖ Teste de Sucesso', 'Esta √© uma notifica√ß√£o de teste do dashboard.', 3000);
    }
    setTimeout(() => {
        if (typeof showError === 'function') {
            showError('‚ùå Teste de Erro', 'Notifica√ß√£o de erro de teste.', 3000);
        }
    }, 1000);
    setTimeout(() => {
        if (typeof showWarning === 'function') {
            showWarning('‚ö†Ô∏è Teste de Alerta', 'Notifica√ß√£o de alerta de teste.', 3000);
        }
    }, 2000);
    setTimeout(() => {
        if (typeof showInfo === 'function') {
            showInfo('‚ÑπÔ∏è Teste de Informa√ß√£o', 'Notifica√ß√£o informativa de teste.', 3000);
        }
    }, 3000);
    
    console.log('üß™ Todas as notifica√ß√µes de teste foram disparadas');
};

// Expor fun√ß√£o de teste no console
console.log('üí° Dica: Digite testarNotificacoesDashboard() no console para testar todas as notifica√ß√µes');
/* ============================================
   üìä SISTEMA DE GR√ÅFICOS INTERATIVOS
   ============================================ */

// Vari√°veis globais para os gr√°ficos
let statusChartInstance = null;
let priorityChartInstance = null;
let timelineChartInstance = null;

// Dados de exemplo (em produ√ß√£o, viriam da API)
const sampleData = {
    status: {
        labels: ['Pendentes', 'Em Andamento', 'Conclu√≠das', 'Canceladas'],
        data: [12, 8, 15, 2],
        colors: ['#ffc107', '#17a2b8', '#28a745', '#6c757d']
    },
    priority: {
        labels: ['Baixa', 'M√©dia', 'Alta', 'Urgente'],
        data: [10, 15, 7, 3],
        colors: ['#28a745', '#17a2b8', '#fd7e14', '#dc3545']
    },
    timeline: {
        labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'],
        data: [5, 8, 12, 10, 15, 18, 20, 22, 25, 30, 28, 35]
    }
};

// Fun√ß√£o para inicializar todos os gr√°ficos
function initializeCharts() {
    console.log('üìä Inicializando gr√°ficos do dashboard...');
    
    // Destruir gr√°ficos existentes (se houver)
    if (statusChartInstance) statusChartInstance.destroy();
    if (priorityChartInstance) priorityChartInstance.destroy();
    if (timelineChartInstance) timelineChartInstance.destroy();
    
    // 1. Gr√°fico de Status
    const statusCtx = document.getElementById('statusChart').getContext('2d');
    statusChartInstance = new Chart(statusCtx, {
        type: 'doughnut',
        data: {
            labels: sampleData.status.labels,
            datasets: [{
                data: sampleData.status.data,
                backgroundColor: sampleData.status.colors,
                borderColor: '#fff',
                borderWidth: 2,
                hoverOffset: 15
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        padding: 20,
                        usePointStyle: true,
                        font: {
                            size: 11
                        }
                    }
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            let label = context.label || '';
                            if (label) {
                                label += ': ';
                            }
                            label += context.raw + ' demandas';
                            return label;
                        }
                    }
                }
            },
            cutout: '65%'
        }
    });
    
    // 2. Gr√°fico de Prioridade
    const priorityCtx = document.getElementById('priorityChart').getContext('2d');
    priorityChartInstance = new Chart(priorityCtx, {
        type: 'bar',
        data: {
            labels: sampleData.priority.labels,
            datasets: [{
                label: 'Quantidade',
                data: sampleData.priority.data,
                backgroundColor: sampleData.priority.colors,
                borderColor: sampleData.priority.colors.map(color => color + 'CC'),
                borderWidth: 1,
                borderRadius: 8,
                borderSkipped: false,
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return `${context.raw} demandas`;
                        }
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        display: true,
                        drawBorder: false
                    },
                    ticks: {
                        stepSize: 5
                    }
                },
                x: {
                    grid: {
                        display: false
                    }
                }
            }
        }
    });
    
    // 3. Gr√°fico de Timeline (Evolu√ß√£o)
    const timelineCtx = document.getElementById('timelineChart').getContext('2d');
    timelineChartInstance = new Chart(timelineCtx, {
        type: 'line',
        data: {
            labels: sampleData.timeline.labels,
            datasets: [{
                label: 'Demandas Criadas',
                data: sampleData.timeline.data,
                backgroundColor: 'rgba(77, 171, 247, 0.1)',
                borderColor: '#4dabf7',
                borderWidth: 3,
                fill: true,
                tension: 0.4,
                pointBackgroundColor: '#4dabf7',
                pointBorderColor: '#fff',
                pointBorderWidth: 2,
                pointRadius: 5,
                pointHoverRadius: 8
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'top',
                    labels: {
                        font: {
                            size: 12
                        }
                    }
                },
                tooltip: {
                    mode: 'index',
                    intersect: false,
                    callbacks: {
                        label: function(context) {
                            return `${context.dataset.label}: ${context.raw} demandas`;
                        }
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        borderDash: [3, 3]
                    },
                    title: {
                        display: true,
                        text: 'Quantidade',
                        font: {
                            size: 12
                        }
                    }
                },
                x: {
                    grid: {
                        display: false
                    }
                }
            },
            interaction: {
                intersect: false,
                mode: 'nearest'
            }
        }
    });
    
    console.log('‚úÖ Gr√°ficos inicializados com sucesso!');
}

// Fun√ß√£o para atualizar gr√°ficos com filtros
function updateChartsWithFilters() {
    console.log('üîÑ Atualizando gr√°ficos com filtros...');
    
    const period = document.getElementById('filterPeriod').value;
    const school = document.getElementById('filterSchool').value;
    const department = document.getElementById('filterDepartment').value;
    const chartType = document.getElementById('chartType').value;
    
    console.log('Filtros aplicados:', { period, school, department, chartType });
    
    // Simular dados filtrados (em produ√ß√£o, faria uma requisi√ß√£o √† API)
    const filteredData = getFilteredData(period, school, department);
    
    // Atualizar tipo do gr√°fico principal
    if (statusChartInstance) {
        statusChartInstance.config.type = chartType;
        statusChartInstance.update();
    }
    
    // Aqui voc√™ atualizaria os dados dos gr√°ficos com os dados filtrados
    // Por enquanto, apenas mostramos uma notifica√ß√£o
    if (typeof showInfo === 'function') {
        showInfo('üîç Filtros Aplicados', 
                `Per√≠odo: ${getPeriodLabel(period)} | Escola: ${school === 'all' ? 'Todas' : school.substring(0, 20)}...`, 
                3000);
    }
}

// Fun√ß√£o para simular dados filtrados
function getFilteredData(period, school, department) {
    // Em produ√ß√£o, isso viria de uma API
    // Aqui retornamos dados de exemplo ajustados pelos filtros
    
    let multiplier = 1;
    if (period === 'week') multiplier = 0.3;
    if (period === 'month') multiplier = 1;
    if (period === 'quarter') multiplier = 3;
    if (period === 'year') multiplier = 12;
    
    return {
        status: sampleData.status.data.map(value => Math.round(value * multiplier)),
        priority: sampleData.priority.data.map(value => Math.round(value * multiplier)),
        timeline: sampleData.timeline.data.map(value => Math.round(value * multiplier))
    };
}

// Fun√ß√£o auxiliar para labels de per√≠odo
function getPeriodLabel(period) {
    const labels = {
        'week': '√öltima Semana',
        'month': '√öltimo M√™s',
        'quarter': '√öltimo Trimestre',
        'year': '√öltimo Ano'
    };
    return labels[period] || 'Per√≠odo';
}

// Fun√ß√£o para exportar gr√°ficos
function exportChart(chartId, format = 'png') {
    const chartCanvas = document.getElementById(chartId);
    if (!chartCanvas) return;
    
    const link = document.createElement('a');
    link.download = `grafico-${chartId}-${new Date().toISOString().slice(0,10)}.${format}`;
    link.href = chartCanvas.toDataURL(`image/${format}`);
    link.click();
    
    if (typeof showSuccess === 'function') {
        showSuccess('üì• Download Iniciado', `Gr√°fico exportado como ${format.toUpperCase()}`, 3000);
    }
}

// Configurar eventos dos filtros
function setupChartFilters() {
    const filterSelects = [
        'filterPeriod',
        'filterSchool', 
        'filterDepartment',
        'chartType'
    ];
    
    filterSelects.forEach(selectId => {
        const select = document.getElementById(selectId);
        if (select) {
            select.addEventListener('change', updateChartsWithFilters);
        }
    });
    
    // Bot√µes de exporta√ß√£o
    document.querySelectorAll('.export-chart').forEach(button => {
        button.addEventListener('click', function() {
            const chartId = this.getAttribute('data-chart');
            const format = this.getAttribute('data-format') || 'png';
            exportChart(chartId, format);
        });
    });
}

// Inicializar tudo quando a p√°gina carregar
document.addEventListener('DOMContentLoaded', function() {
    // Pequeno delay para garantir que Chart.js carregou
    setTimeout(() => {
        if (typeof Chart !== 'undefined') {
            initializeCharts();
            setupChartFilters();
            
            // Adicionar bot√µes de exporta√ß√£o dinamicamente
            addExportButtons();
            
            console.log('üé® Sistema de gr√°ficos pronto!');
            
            // Notifica√ß√£o de boas-vindas com gr√°ficos
            setTimeout(() => {
                if (typeof showInfo === 'function') {
                    showInfo('üìä Gr√°ficos Carregados', 
                            'Agora voc√™ tem visualiza√ß√µes interativas das suas demandas!', 
                            4000);
                }
            }, 1000);
        } else {
            console.error('‚ùå Chart.js n√£o carregou!');
        }
    }, 500);
});

// Adicionar bot√µes de exporta√ß√£o
function addExportButtons() {
    // Adicionar no cabe√ßalho do card de gr√°ficos
    const chartHeader = document.querySelector('.chart-card .card-header');
    if (chartHeader) {
        const exportDiv = document.createElement('div');
        exportDiv.className = 'mt-2';
        exportDiv.innerHTML = `
            <small class="text-muted me-2">Exportar:</small>
            <div class="btn-group btn-group-sm" role="group">
                <button type="button" class="btn btn-outline-secondary export-chart" data-chart="statusChart" data-format="png">
                    <i class="fas fa-download me-1"></i>Gr√°fico 1
                </button>
                <button type="button" class="btn btn-outline-secondary export-chart" data-chart="priorityChart" data-format="png">
                    <i class="fas fa-download me-1"></i>Gr√°fico 2
                </button>
                <button type="button" class="btn btn-outline-secondary export-chart" data-chart="timelineChart" data-format="png">
                    <i class="fas fa-download me-1"></i>Gr√°fico 3
                </button>
            </div>
        `;
        chartHeader.appendChild(exportDiv);
    }
}

// Fun√ß√£o para atualizar dados em tempo real (simula√ß√£o)
function simulateRealTimeUpdate() {
    // Em produ√ß√£o, isso seria feito com WebSockets ou polling
    setInterval(() => {
        // Simular pequenas altera√ß√µes nos dados
        if (statusChartInstance && Math.random() > 0.7) {
            const newData = sampleData.status.data.map(value => 
                Math.max(0, value + Math.floor(Math.random() * 3) - 1)
            );
            
            statusChartInstance.data.datasets[0].data = newData;
            statusChartInstance.update('none');
            
            console.log('üîÑ Dados do gr√°fico de status atualizados');
        }
    }, 30000); // Atualizar a cada 30 segundos
}

// Iniciar atualiza√ß√£o em tempo real ap√≥s 1 minuto
setTimeout(simulateRealTimeUpdate, 60000);

// Expor fun√ß√µes para debugging
window.dashboardCharts = {
    initializeCharts,
    updateChartsWithFilters,
    exportChart,
    getSampleData: () => sampleData
};

console.log('üí° Dica: Use dashboardCharts no console para controlar os gr√°ficos');
</script>

</body>
</html>